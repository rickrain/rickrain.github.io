<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Developing Native Client Apps for Azure Active Directory" /><meta property="og:locale" content="en" /><meta name="description" content="In my post titled Building Web Apps for Azure AD, I discussed developing two types of applications protected by Azure Active Directory: web applications and web API’s. In that post I approached these applications from the perspective of a developer using Visual Studio 2013 and the project templates provided for creating these types of applications. The automation delivered by Visual Studio and the Azure SDK when creating these applications resulted in the two applications being registered in my Azure Active Directory as shown here." /><meta property="og:description" content="In my post titled Building Web Apps for Azure AD, I discussed developing two types of applications protected by Azure Active Directory: web applications and web API’s. In that post I approached these applications from the perspective of a developer using Visual Studio 2013 and the project templates provided for creating these types of applications. The automation delivered by Visual Studio and the Azure SDK when creating these applications resulted in the two applications being registered in my Azure Active Directory as shown here." /><link rel="canonical" href="https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/" /><meta property="og:url" content="https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2014-12-08T15:06:04-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Developing Native Client Apps for Azure Active Directory" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2014-12-08T15:06:04-06:00","description":"In my post titled Building Web Apps for Azure AD, I discussed developing two types of applications protected by Azure Active Directory: web applications and web API’s. In that post I approached these applications from the perspective of a developer using Visual Studio 2013 and the project templates provided for creating these types of applications. The automation delivered by Visual Studio and the Azure SDK when creating these applications resulted in the two applications being registered in my Azure Active Directory as shown here.","headline":"Developing Native Client Apps for Azure Active Directory","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/"},"url":"https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/"}</script><title>Developing Native Client Apps for Azure Active Directory | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Developing Native Client Apps for Azure Active Directory</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Developing Native Client Apps for Azure Active Directory</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 8, 2014, 3:06 PM -0600" >Dec 8, 2014<i class="unloaded">2014-12-08T15:06:04-06:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3333 words">18 min read</span></div></div><div class="post-content"><p>In my post titled <a href="http://rickrainey.com/2014/11/05/building-web-apps-for-azure-ad/">Building Web Apps for Azure AD</a>, I discussed developing two types of applications protected by Azure Active Directory: web applications and web API’s. In that post I approached these applications from the perspective of a developer using Visual Studio 2013 and the project templates provided for creating these types of applications. The automation delivered by Visual Studio and the Azure SDK when creating these applications resulted in the two applications being registered in my Azure Active Directory as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-01.png" alt="Azure AD Apps" /></p><p>Testing the CloudAlloc.Website was a matter of simply pressing F5 in Visual Studio to launch a browser and access the application. Recall this application is protected using WS-Federation which redirects unauthenticated users to a sign-in page. After successfully authenticating, the user is redirected back to the CloudAlloc.Website URL.</p><p>The CloudAlloc.WebAPI is protected using OAuth 2.0 and expects a valid token in the authorization header when its endpoint is accessed. In this post I am going to continue where I left off with the Web API application and discuss how you can develop a native client to acquire an access token that can be used to access the Web API.</p><p>A native client application is one that is installed on a user’s computer or device. Examples of such an application include, but is not limited to, WinForms, WPF, Windows Store, Windows Phone, and iOS applications. And while these applications may not necessarily run in Azure as compared to the web application and web API applications discussed in the previous post, native client applications can be protected by Azure Active Directory and access other applications registered with Azure Active Directory.</p><h2 id="using-claims-in-the-web-api-to-drive-applicaion-behavior">Using Claims in the Web API to drive applicaion behavior</h2><p>Before getting into the development of a native client, I want to first point out two changes I made to the Web API to facilitate the topics discussed in this post.</p><p>For the Get method, I changed the default implementation provided by the Visual Studio project template to extract the claims from the authenticated user and look for a scope claim with a value of <em>Read_CloudAlloc_WebAPI</em> or <em>Read_Write_CloudAlloc_WebAPI</em>. If the scope claim is found and contains one of these values, then I return HTTP 200 (OK). Otherwise, I return an HTTP 401 (Unauthorized).You may be wondering where I got the scope claim and value. Azure Active Directory will add this claim and value to the claim set for authenticated users provided that my Web API has been configured to support this claim and my client (native client) has been granted the permissions to include the claim. I’ll come back to this shortly. For now, just understand that with this code, the Web API now requires that this claim and value be present for the user to be able to read these values.The updated Get method implementation is shown here.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// GET api/values</span>
<span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">Get</span><span class="p">()</span>
<span class="p">{</span>
      <span class="c1">// Look for the scope claim containing the</span>
      <span class="c1">//  value 'Read_CloudAlloc_WebAPI' or 'Read_Write_CloudAlloc_WebAPI'</span>
      <span class="kt">var</span> <span class="n">principal</span> <span class="p">=</span> <span class="n">ClaimsPrincipal</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
      <span class="n">Claim</span> <span class="n">readValuesClaim</span> <span class="p">=</span> <span class="n">principal</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span>
            <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"http://schemas.microsoft.com/identity/claims/scope"</span> <span class="p">&amp;&amp;</span>
            <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Read_CloudAlloc_WebAPI"</span><span class="p">)</span> <span class="p">||</span>
            <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Read_Write_CloudAlloc_WebAPI"</span><span class="p">))));</span>
 
      <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">readValuesClaim</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="c1">//</span>
          <span class="c1">// Code to retrieve values to include in the response goes here.</span>
          <span class="c1">//</span>
          <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">);</span>            <span class="p">}</span>
       <span class="k">else</span>
       <span class="p">{</span>
          <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateErrorResponse</span><span class="p">(</span>
              <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Unauthorized</span><span class="p">,</span> <span class="s">"You don't have permissions to read values."</span><span class="p">);</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>For the Post method, I made similar changes but instead look for the scope claim containing the value <em>Read_Write_CloudAlloc_WebAPI</em>. If the scope claim is found and contains this value, then I return HTTP 201 (Created) to simulate the value being added to the server. Otherwise, I return an HTTP 401 (Unauthorized). The updated Post method implementation is shown here.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">// POST api/values</span>
<span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
      <span class="c1">// Look for the scope claim containing the value 'Read_Write_CloudAlloc_WebAPI'</span>
      <span class="kt">var</span> <span class="n">principal</span> <span class="p">=</span> <span class="n">ClaimsPrincipal</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
      <span class="n">Claim</span> <span class="n">writeValuesClaim</span> <span class="p">=</span> <span class="n">principal</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span>
          <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"http://schemas.microsoft.com/identity/claims/scope"</span> <span class="p">&amp;&amp;</span>
              <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Read_Write_CloudAlloc_WebAPI"</span><span class="p">));</span>
 
       <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">writeValuesClaim</span><span class="p">)</span>
       <span class="p">{</span>
           <span class="c1">//</span>
           <span class="c1">// Code to add the resource goes here.</span>
           <span class="c1">//</span>
           <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Created</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="k">else</span>
       <span class="p">{</span>
           <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateErrorResponse</span><span class="p">(</span>
               <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Unauthorized</span><span class="p">,</span> <span class="s">"You don't have permissions to write values."</span><span class="p">);</span>
       <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Note: Generally it is recommended to organize code that tests for the presence of claims with this level of granularity into a custom <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.authorizeattribute(v=vs.118).aspx">AuthorizeAttribute class</a>. By doing so you isolate the authorization code into one place, reducing the potential for error and improving maintainability of the code. However, in the interest of keeping the focus in this section on how claims can be used to make authorization decisions, I’m including it directly in the method for readability.</p></blockquote><h2 id="exposing-the-web-api-to-other-applications">Exposing the Web API to other applications</h2><p>To make the Web API accessible to other applications in Azure Active Directory, permissions must be defined for the Web API that can be assigned to other applications. The Azure Management portal does not provide a user interface to do this. However, it does offer you access to the application’s manifest where you can configure settings for an application, including settings that the portal doesn’t provide a user interface for. Here are the steps to get to an application’s manifest using the Azure Management portal.</p><ol><li>Go to the <strong>APPLICATIONS</strong> page for the Azure Active Directory the application is registered in.<li>Click on the name of the application whose manifest you’re interested in. For this post, it is the CloudAlloc.WebAPI application.<li>At the bottom of the screen click on the <strong>MANAGE MANIFEST</strong> button and select the option to <strong>Download Manifest</strong> and save it to your local computer, as shown here.</ol><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-02.png" alt="Download manifest" /></p><p>The manifest is a JSON formatted file that contains the Azure Active Directory configuration for an application registered in Azure Active Directory. If you scroll through the file you will see the settings you see on the <strong>CONFIGURE</strong> page for an application and much more. The configuration setting we’re interested in for this post is the oauth2Permissions setting. By default, this is an empty array, as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-03.png" alt="Default oauth2Permissions setting" /></p><p>For this application (the CloudAlloc.WebAPI), I am adding two permissions to this array; one that allows read access to the API and one that allows read/write access to the API. Notice the value that I indicated for each permission. This is where the values I’m looking for in the scope claim originate from in the Get and Post methods above.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span text-data=" JSON "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="nl">"oauth2Permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"adminConsentDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow read access to the CloudAlloc WebAPI on behalf of the signed-in user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"adminConsentDisplayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read access to CloudAlloc WebAPI"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1835E3A9-C857-4F33-A357-751E620E558D"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Application"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userConsentDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow read access to the CloudAlloc WebAPI on your behalf"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userConsentDisplayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read access to CloudAlloc WebAPI"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read_CloudAlloc_WebAPI"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"adminConsentDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow read-write access to the CloudAlloc WebAPI on behalf of the signed-in user"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"adminConsentDisplayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read-Write access to CloudAlloc WebAPI"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"87A81936-E765-4678-B6DB-8E12197AAA7D"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isEnabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Application"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userConsentDescription"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow read-write access to the CloudAlloc WebAPI on your behalf"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"userConsentDisplayName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read-Write access to CloudAlloc WebAPI"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Read_Write_CloudAlloc_WebAPI"</span><span class="w">
  </span><span class="p">}]</span><span class="err">,</span><span class="w">
</span></pre></table></code></div></div><p>The schema for the oauth2Permissions can be found in the MSDN documentation for <a href="http://msdn.microsoft.com/en-us/library/azure/dn132599.aspx">adding, updating, and removing an application in Azure Active Directory</a>.</p><p>After making this update to the manifest file all that is left is to upload it to Azure by clicking the <strong>MANAGE MANIFEST</strong> button and selecting the <strong>Upload Manifest</strong> option.</p><p>Now the Web API application can be accessed from other applications using these permissions.</p><h2 id="add-a-native-client-application-to-azure-active-directory">Add a native client application to Azure Active Directory</h2><p>Regardless of the type of native client application you plan to build, the first step is to register it in Azure Active Directory. This is easily done using the Azure Management portal by clicking the <strong>ADD</strong> button in the <strong>APPLICATIONS</strong> page of the directory and selecting the option to <strong>add an application my organization is developing</strong>. This will open a wizard where you can specify the name and type of application as I’ve done here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-04.png" alt="Add Azure AD application" /></p><p>The next page of the wizard will prompt you for the redirect URI associated with the native client application. This is a URI (not a URL), so any value will work as long as it is a valid URI and is unique to your directory as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-05.png" alt="Add Azure AD application URI" /></p><p>That is all that is required to register the application with Azure Active Directory. The application will appear in the <strong>APPLICATIONS</strong> page of the directory as a Native client application as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-06.png" alt="Azure AD applications page" /></p><h2 id="configure-permissions-to-access-the-web-api">Configure permissions to access the Web API</h2><p>Since this native client application is going to be accessing the CloudAlloc.WebAPI I need to configure the permissions for it. In the <strong>CONFIGURE</strong> page of the native client application is where permissions to other applications can be set. And since my Web API application is now accessible as a result of the manifest changes I made earlier, I can easily configure the native client with the permissions I want to give it. For now, I’m going to start by assigning the <em>Read access to CloudAlloc WebAPI</em> permission as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-07.png" alt="Azure AD application permissions" /></p><p>As users of the native client application authenticate to Azure Active Directory, they will now get the scope claim with a value of <em>Read_CloudAlloc_WebAPI</em> in addition to other claims issued by Azure Active Directory.</p><h2 id="develop-the-native-client-application">Develop the native client application</h2><p>For this post I’m going to build a simple console application for the native client. However, the code in this application would work the same for other types.</p><p>Recall that my Web API is protected by Azure AD and expects a security token when accessed from client applications. So, I need a way to authenticate users and acquire a security token (JWT) that can be used when calling the API. Thankfully, Microsoft provides a super-handy library called the Active Directory Authentication Library (ADAL) that simplifies this. Since my client application is a C# console application, I’ll be using <a href="https://github.com/AzureAD/azure-activedirectory-library-for-dotnet">ADAL for .NET</a> (version 2.x). But, there are other flavors available such as <a href="https://github.com/AzureAD/azure-activedirectory-library-for-js">ADAL for JavaScript</a>, <a href="https://github.com/AzureAD/azure-activedirectory-library-for-nodejs">ADAL for Node.js</a>, <a href="https://github.com/AzureAD/azure-activedirectory-library-for-java">ADAL for Java</a>, <a href="https://github.com/AzureAD/azure-activedirectory-library-for-android">ADAL for Android</a>, and <a href="https://github.com/AzureAD/azure-activedirectory-library-for-objc">ADAL for iOS and OSX</a> making native client application development for Azure AD a breeze for the most popular languages and platforms used in the enterprise.</p><p>To construct the HTTP requests to my Web API, I will use the <a href="https://www.nuget.org/packages/Microsoft.Net.Http">Microsoft HTTP Client Libraries</a> (version 2.x).</p><h3 id="define-settings-used-by-the-native-client-application">Define settings used by the native client application</h3><p>The native client application needs the Client ID and Redirect URI of the application registered with Azure AD. The Client ID is generated automatically when the application is registered and the Redirect URI is the URI entered in the new application wizard earlier.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Native client application settings</span>
<span class="k">private</span> <span class="kt">string</span> <span class="n">clientID</span> <span class="p">=</span> <span class="s">"386985f0-b940-4713-a8e5-f7a49d39f368"</span><span class="p">;</span>
<span class="k">private</span> <span class="n">Uri</span> <span class="n">redirectUri</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"http://cloudalloc.webapi.client"</span><span class="p">);</span>
</pre></table></code></div></div><p>Both of these settings can be found in the properties section of the <strong>CONFIGURE</strong> page for the native client application in the Azure Management portal as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-08.png" alt="Azure AD application configuration" /></p><p>When a native client needs to get a token from Azure Active Directory, it needs to specify the resource it wants a token for. In this scenario the client application wants access to the Web API so the APP ID URI for the Web API is used as the resource name. After it has the token it also needs to know the URL where the resource can be accessed, in this case the address of the Web API.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Resource settings this application wants to access</span>
<span class="k">private</span> <span class="kt">string</span> <span class="n">resource</span> <span class="p">=</span> <span class="s">"https://cloudalloc.com/CloudAlloc.WebAPI"</span><span class="p">;</span>
<span class="k">private</span> <span class="n">Uri</span> <span class="n">WebAPIUri</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="s">"https://localhost:44313"</span><span class="p">);</span>
</pre></table></code></div></div><p>Both of these settings can be found in the single sign-on section of the <strong>CONFIGURE</strong> page for the Web API application in the Azure Management portal as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-09.png" alt="Azure AD application configuration" /></p><blockquote><p>Note: The reason the reply URL is a localhost address is simply because in the previous post when these applications were created and registered in Azure Active Directory, I didn’t publish them to Azure Websites. If I had, then this reply URL would have a *.azurewebsites.net address instead. To see how publishing a web application and/or web API to Azure applies to applications registered in Azure Active Directory see my post on <a href="http://rickrainey.com/2014/07/28/authenticating-with-organizational-accounts-and-azure-active-directory/">Authenticating with Organizational Accounts and Azure Active Directory</a>.</p></blockquote><p>For ADAL to authenticate the user and acquire a token for the resource, an <strong>AuthenticationContext</strong> must first be instantiated by passing in the URL of your tenant in Azure Active Directory. The URL is of the form *https://login.windows.net/<tenantID>* where <tenantID> can be either the GUID assigned to your tenant in Azure AD or the domain if you have a custom domain configured.</tenantID></tenantID></p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// Session to Azure AD</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">authority</span> <span class="p">=</span> <span class="s">"https://login.windows.net/cloudalloc.com"</span><span class="p">;</span>
<span class="k">private</span> <span class="n">AuthenticationContext</span> <span class="n">authContext</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthenticationContext</span><span class="p">(</span><span class="n">authority</span><span class="p">);</span>
</pre></table></code></div></div><p>The <strong>AuthenticationContext</strong> is like a connection to your Azure Active Directory and is ultimately used to acquire tokens from your directory.</p><h2 id="call-the-web-api-to-get-values">Call the Web API to get values</h2><p>The code to issue an HTTP GET request to the Web API essentially breaks down to three tasks:</p><ol><li>Authenticate the user and get a token from Azure Active Directory. Here is where the <strong>AuthenticationContext</strong> instance is used to call the <strong>AcquireToken</strong> method. If the user is not already authenticated, then the ADAL library will launch a sign-in page for the user to sign-in with. After successfully authenticating, a security tokento access the resource using the native client application is issued.<li>An <strong>HttpClient</strong> instance is instantiated and configured to include the <em>security token</em> in the <strong>Authorization</strong> header for HTTP calls to the resource (Web API).<li>An HTTP GET is issued to the resource’s URL to retrieve the values.</ol><p>The full source code for the native client to call the Get method on the Web API is shown here.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="nf">ReadValues</span><span class="p">()</span>
<span class="p">{</span>
      <span class="c1">// Authenticate the user and get a token from Azure AD</span>
      <span class="n">AuthenticationResult</span> <span class="n">authResult</span> <span class="p">=</span> <span class="n">authContext</span><span class="p">.</span><span class="nf">AcquireToken</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">clientID</span><span class="p">,</span> <span class="n">redirectUri</span><span class="p">);</span>
 
      <span class="c1">// Create an HTTP client and add the token to the Authorization header</span>
      <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
      <span class="n">httpClient</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Authorization</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthenticationHeaderValue</span><span class="p">(</span>
          <span class="n">authResult</span><span class="p">.</span><span class="n">AccessTokenType</span><span class="p">,</span> <span class="n">authResult</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">);</span>
 
      <span class="c1">// Call the Web API to get the values</span>
      <span class="n">Uri</span> <span class="n">requestURI</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">WebAPIUri</span><span class="p">,</span> <span class="s">"api/values"</span><span class="p">);</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Reading values from '{0}'."</span><span class="p">,</span> <span class="n">requestURI</span><span class="p">);</span>
      <span class="n">HttpResponseMessage</span> <span class="n">httpResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">GetAsync</span><span class="p">(</span><span class="n">requestURI</span><span class="p">);</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"HTTP Status Code: '{0}'"</span><span class="p">,</span> <span class="n">httpResponse</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="c1">//</span>
          <span class="c1">// Code to do something with the data returned goes here.</span>
          <span class="c1">//</span>
      <span class="p">}</span>           
      <span class="k">return</span> <span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="call-the-web-api-to-post-a-new-value">Call the Web API to post a new value</h2><p>The code to issue an HTTP POST request to the Web API is almost identical. Since this method expects a new value in the body of the POST, the content-type header needs to be set and the content needs to be passed along in the body. Otherwise, it’s the same code.</p><p>The full source code for the native client to call the Post method on the Web API is shown here.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">async</span> <span class="n">Task</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="nf">WriteValue</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
      <span class="c1">// Authenticate the user and get a token from Azure AD</span>
      <span class="n">AuthenticationResult</span> <span class="n">authResult</span> <span class="p">=</span> <span class="n">authContext</span><span class="p">.</span><span class="nf">AcquireToken</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">clientID</span><span class="p">,</span> <span class="n">redirectUri</span><span class="p">);</span>
 
      <span class="c1">// Create an HTTP client and add the token to the Authorization header</span>
      <span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpClient</span><span class="p">();</span>
      <span class="n">httpClient</span><span class="p">.</span><span class="n">DefaultRequestHeaders</span><span class="p">.</span><span class="n">Authorization</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AuthenticationHeaderValue</span><span class="p">(</span>
          <span class="n">authResult</span><span class="p">.</span><span class="n">AccessTokenType</span><span class="p">,</span> <span class="n">authResult</span><span class="p">.</span><span class="n">AccessToken</span><span class="p">);</span>
 
 
      <span class="c1">// Construct the payload for the HTTP post operation</span>
      <span class="kt">var</span> <span class="n">newValue</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringContent</span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
      <span class="n">newValue</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MediaTypeHeaderValue</span><span class="p">(</span><span class="s">"application/x-www-form-urlencoded"</span><span class="p">);</span>
 
      <span class="c1">// Call the Web API to post the new values</span>
      <span class="n">Uri</span> <span class="n">requestURI</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">WebAPIUri</span><span class="p">,</span> <span class="s">"api/values"</span><span class="p">);</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Writing value '{0}' to '{1}'."</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">requestURI</span><span class="p">);</span>
      <span class="n">HttpResponseMessage</span> <span class="n">httpResponse</span> <span class="p">=</span> <span class="k">await</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">requestURI</span><span class="p">,</span> <span class="n">newValue</span><span class="p">);</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"HTTP Status Code: '{0}'"</span><span class="p">,</span> <span class="n">httpResponse</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
 
      <span class="k">return</span> <span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="running-the-native-client-application">Running the native client application</h2><p>My primitive console application calls the <strong>ReadValues</strong> method and then the <strong>WriteValue</strong> method shown above. When <strong>AcquireToken</strong> is called in the <strong>ReadValues</strong> method, I am immediately prompted to sign-in since a token doesn’t already exist for me.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-10.png" alt="Azure AD Sign-In" /></p><p>After successfully authenticating, a token is issued to me and the values are returned from the Get method of the Web API because the security token included the scope claim with the <em>Read_CloudAlloc_WebAPI</em> value.</p><p>Next, the <strong>WriteValue</strong> method is called. This time I am not prompted to sign-in because ADAL has cached my token and can use it since it hasn’t expired (more on this shortly). However, because the <em>Read_Write_CloudAlloc_WebAPI</em> value is not present in the scope claim, the Post method in the Web API returned an HTTP 401 (Unauthorized).</p><p>The full output of the console application is shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-11.png" alt="Console output" /></p><p>Using the Azure Management portal, I can change the permissions for my native client application to grant the read/write permission instead, as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-12.png" alt="Azure AD Application Permissions" /></p><p>Running the native client application now results in a successful call to both the Get and Post methods as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-13.png" alt="Console output" /></p><h2 id="adals-token-cache-and-refresh-tokens">ADAL’S Token Cache and Refresh Tokens</h2><p>Previously I mentioned that ADAL cached my token. ADAL does this automatically without you having to write any code, resulting in a positive experience for the end-user. If the token hasn’t expired, ADAL will re-use it in subsequent calls to <strong>AcquireToken</strong>. However, even if the token has expired, the end-user may still avoid being prompted to sign-in if a <em>refresh token</em> was issued when the access token was issued.</p><p>A refresh token, which may not always be present, can be used to acquire a new access token on behalf of the user if Azure AD allows it. As long as the user’s account in Azure AD hasn’t been deleted, disabled, or some other change in the directory that would invalidate the token, the refresh token can be exchanged for a new access token. Best of all, ADAL will use the refresh token to acquire a new access token if it can and do so without you having to write any code.</p><p>The figure below shows an instance of the <strong>AuthenticationResult</strong> returned from the first call to <strong>AcquireToken</strong>. You can see the time the <strong>AccessToken</strong> expires in the <strong>ExpiresOn</strong> property and the <strong>RefreshToken</strong> ADAL may use to acquire a new <strong>AccessToken</strong>.</p><p>And it’s not always just for a single resource that a refresh token can be used to acquire an access token. If the <strong>IsMultipleResourceRefreshToken</strong> property is set to true, the <strong>RefreshToken</strong> can also be used to acquire an <strong>AccessToken</strong> for other resources registered in my Azure AD. Currently, I’m only accessing the Web API, but if my native client accessed another resource, then this <strong>RefreshToken</strong> could be used to acquire the <strong>AccessToken</strong> for that resource too without me having to sign-in.</p><p><img data-proofer-ignore data-src="/assets/img/developing-native-client-apps-for-azure-ad-14.png" alt="Refresh Tokens" /></p><p>As you can see, ADAL provides a lot of benefits to native client applications with just a couple of lines of code.</p><h2 id="summary">Summary</h2><p>In this post I demonstrated how to use claims in a Web API application protected by Azure Active Directory to make authorization decisions based on the presence of a scope claim in the authenticated user’s claim set.</p><p>Next, I discussed how to expose the Web API to other applications in Azure AD by defining permissions in the <em>oauth2Permissions</em> array that can be updated in the manifest file for the Web API. By defining permissions for the Web API, other applications can be configured to access the application with selected permissions using the Azure Management portal.</p><p>After the Web API was updated and configured, I discussed the steps necessary to register a native client application in Azure Active Directory. Using values in Azure Active Directory for the registered native client application, I then showed how to develop a console application that uses the Active Directory Authentication Library (ADAL) and the Microsoft HTTP Client Library to securely call the Web API. Running the native client, we were able to observe the benefit of the token cache provided by ADAL and the use of a refresh token to avoid unnecessarily prompting the user for credentials.</p><p>In the next post, I will show how you can extend this scenario and make authorizations decisions based on a user’s group membership.</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2014/12/08/developing-native-client-apps-for-azure-active-directory/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Developing Native Client Apps for Azure Active Directory - Rick Rainey&url=https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Developing Native Client Apps for Azure Active Directory - Rick Rainey&u=https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Developing Native Client Apps for Azure Active Directory - Rick Rainey&url=https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"><div class="card-body"> <span class="timeago small" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h3><div class="text-muted small"><p> Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few mi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2014/11/05/building-web-apps-for-azure-ad/" class="btn btn-outline-primary" prompt="Older"><p>Building Web Apps for Azure AD</p></a> <a href="/2015/02/13/using-group-claims-in-azure-active-directory/" class="btn btn-outline-primary" prompt="Newer"><p>Using Group Claims in Azure Active Directory</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/'; this.page.identifier = '/2014/12/08/developing-native-client-apps-for-azure-active-directory/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
