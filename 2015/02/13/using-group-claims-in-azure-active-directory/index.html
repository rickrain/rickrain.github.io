<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Using Group Claims in Azure Active Directory" /><meta property="og:locale" content="en" /><meta name="description" content="In the post titled Developing Native Client Apps for Azure AD I showed how you can use the Active Directory Authentication Library (ADAL) to build a native client application that calls the CloudAlloc.WebAPI introduced in the post titled Building Web Apps for Azure AD. As part of that post, I demonstrated how the Web API could be exposed to other applications using ouath2Permissions that I defined in the manifest which enabled me to assign permissions to my native client application as shown here." /><meta property="og:description" content="In the post titled Developing Native Client Apps for Azure AD I showed how you can use the Active Directory Authentication Library (ADAL) to build a native client application that calls the CloudAlloc.WebAPI introduced in the post titled Building Web Apps for Azure AD. As part of that post, I demonstrated how the Web API could be exposed to other applications using ouath2Permissions that I defined in the manifest which enabled me to assign permissions to my native client application as shown here." /><link rel="canonical" href="https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/" /><meta property="og:url" content="https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-02-13T15:06:04-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Using Group Claims in Azure Active Directory" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2015-02-13T15:06:04-06:00","description":"In the post titled Developing Native Client Apps for Azure AD I showed how you can use the Active Directory Authentication Library (ADAL) to build a native client application that calls the CloudAlloc.WebAPI introduced in the post titled Building Web Apps for Azure AD. As part of that post, I demonstrated how the Web API could be exposed to other applications using ouath2Permissions that I defined in the manifest which enabled me to assign permissions to my native client application as shown here.","headline":"Using Group Claims in Azure Active Directory","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/"},"url":"https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/"}</script><title>Using Group Claims in Azure Active Directory | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Using Group Claims in Azure Active Directory</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Using Group Claims in Azure Active Directory</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Feb 13, 2015, 3:06 PM -0600" >Feb 13, 2015<i class="unloaded">2015-02-13T15:06:04-06:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1821 words">10 min read</span></div></div><div class="post-content"><p>In the post titled <a href="http://rickrainey.com/2014/12/08/developing-native-client-apps-for-azure-active-directory/">Developing Native Client Apps for Azure AD</a> I showed how you can use the Active Directory Authentication Library (ADAL) to build a native client application that calls the CloudAlloc.WebAPI introduced in the post titled <a href="http://rickrainey.com/2014/11/05/building-web-apps-for-azure-ad/">Building Web Apps for Azure AD</a>. As part of that post, I demonstrated how the Web API could be exposed to other applications using <em>ouath2Permissions</em> that I defined in the manifest which enabled me to assign permissions to my native client application as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-01.png" alt="Permissions to other apps" /></p><p>Being able to assign read and write permissions in this way provided an easy and useful way to control an application’s ability to invoke various operations using the claims that were issued by Azure Active Directory for an authenticated user. However, the level of granularity for which authorization decisions can be made in the application code is pretty coarse with this approach. In my example, it was the simple read and write permissions I defined and if the native client application was configured to allow write permissions, then any authenticated user would be able to invoke such operations. While that may be sufficient for some applications, others may require additional information about the user before making such authorization decisions. For example, you may want to restrict write operations to users in a specific security group. As you can see below, the claims provided by Azure Active Directory for our authenticated user John Doe just don’t provide that level of detail about the user (yet). Other than some various identifier claims about John Doe, we’re currently limited to the values in the <em>scope</em> claim to make authorization decisions.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-02.png" alt="Default user claims" /></p><p>A common need for many applications is the ability to make authorization decisions based on a user’s membership in a specific security group (or groups). In this post I’m going to show how you can take advantage of some recently released features of Azure Active Directory to do just that.</p><h2 id="using-group-claims-to-drive-authorization-decisions">Using group claims to drive authorization decisions</h2><p>Very recently, the Azure Active Directory team announced the <a href="http://blogs.technet.com/b/ad/archive/2014/12/18/azure-active-directory-now-with-group-claims-and-application-roles.aspx">preview release of two new features: group claims and application roles</a>. Before this, you had to use the <a href="https://msdn.microsoft.com/en-us/library/azure/hh974478.aspx">Azure AD Graph API</a> to determine a user’s membership in a group. Now, you can just look for it in the <em>Claims</em> collection for the authenticated user provided you enable the group claims feature for your application in Azure AD. Let’s see how this would work for the application we’ve been talking about and only allow users to invoke the POST method if they are in the “Dev/Test” security group.</p><h3 id="enable-group-claims-for-the-cloudallocwebapi-application">Enable group claims for the cloudalloc.webapi application</h3><p>Enabling the group claims feature currently requires that you update the manifest for the application in Azure AD. This is exactly the same process I showed you in the last post where I set the <em>oauth2Permissions</em> for the application.</p><p>In the Azure Management portal I’ll begin by going to the <strong>CONFIGURE</strong> page for the CloudAlloc.WebAPI application in Azure AD. At the bottom of the page is a <strong>MANAGE MANIFEST</strong> button where I can select to download the manifest for the CloudAlloc.WebAPI application as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-03.png" alt="Download manifest" /></p><p>The application manifest is just a JSON file that you can edit with the simplest of editors (ie: notepad.exe). By the way, if you’re curious what the GUID in the filename is about when you download the manifest, it is the Client ID that was assigned to the application when it was registered in Azure AD. Scrolling down the manifest file I will find the <em>groupMembershipClaims</em> property which will be set to null as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-04.png" alt="Group Membership Claims" /></p><p>I’m going to change this value to <em>SecurityGroup</em> and then save the changes as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-05.png" alt="Group Membership Claims" /></p><p>Your choices for setting the <em>groupMembershipClaims</em> property are <em>null</em> (the default), <em>All</em> or <em>SecurityGroup</em>. If you choose <em>SecurityGroup</em> you will get group claims in the JWT token for just security groups the user is a member of. If you choose <em>All</em> you will get group claims in the JWT token for security groups and distribution lists the user is a member of.</p><p>All that remains now is to upload the modified manifest file which I did using the <strong>MANAGE MANIFEST</strong> button.</p><p>With that change in place, I will now start getting group claims in the token for users of my application. As mentioned above, I’m interested in checking for the user’s existence in the Dev/Test security group. So, before I show you the code changes needed to do this, let’s review my security groups and where our John Doe user lands in these groups.</p><h3 id="locate-the-objec-id-for-the-devtest-security-group">Locate the Objec ID for the Dev/Test Security Group</h3><p>When Azure AD adds applicable group claims to the token it issues for my users, the value for the group claim will be the Object ID of the security group and not the name of the security group. Remember, every entity in Azure AD has a unique Object ID associated with it. You may think it would be more intuitive to refer to the group by name instead of the Object ID. This is true. However, a group’s name can be changed in the directory so it is not a reliable identifier for the group. The Object ID will never change as long as the group exists. So, in this case, I need to find the Object ID for the Dev/Test security group. This can be found in the <strong>CONFIGURE</strong> page of for my Dev/Test security group as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-06.png" alt="Dev/Test Configure Page" /></p><p>Now that I have the Object ID for the Dev/Test security group I am ready to make the necessary code changes.</p><h3 id="update-the-post-method-to-look-for-the-devtest-group-claim">Update the POST method to look for the Dev/Test Group Claim</h3><p>The only code change needed is to look for a <em>groups</em> claim with the value of “244728b5-8b9e-4e2f-8703-9853366cd431” (yours will be different) in the authenticated user’s claims collection as shown here.</p><div class="language-c# highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">// POST api/values</span>
<span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">Post</span><span class="p">([</span><span class="n">FromBody</span><span class="p">]</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Look for the scope claim containing the value 'Read_Write_CloudAlloc_WebAPI'</span>
    <span class="kt">var</span> <span class="n">principal</span> <span class="p">=</span> <span class="n">ClaimsPrincipal</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
    <span class="n">Claim</span> <span class="n">writeValuesClaim</span> <span class="p">=</span> <span class="n">principal</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span>
        <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"http://schemas.microsoft.com/identity/claims/scope"</span> <span class="p">&amp;&amp;</span>
            <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Read_Write_CloudAlloc_WebAPI"</span><span class="p">));</span>
 
    <span class="c1">// Look for the groups claim for the 'Dev/Test' group.</span>
    <span class="k">const</span> <span class="kt">string</span> <span class="n">devTestGroup</span> <span class="p">=</span> <span class="s">"244728b5-8b9e-4e2f-8703-9853366cd431"</span><span class="p">;</span>
    <span class="n">Claim</span> <span class="n">groupDevTestClaim</span> <span class="p">=</span> <span class="n">principal</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span>
        <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"groups"</span> <span class="p">&amp;&amp;</span>
            <span class="n">c</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="nf">Equals</span><span class="p">(</span><span class="n">devTestGroup</span><span class="p">,</span> <span class="n">StringComparison</span><span class="p">.</span><span class="n">CurrentCultureIgnoreCase</span><span class="p">));</span>
 
    <span class="c1">// If the app has write permissions and the user is in the Dev/Test group...</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">null</span> <span class="p">!=</span> <span class="n">writeValuesClaim</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="k">null</span> <span class="p">!=</span> <span class="n">groupDevTestClaim</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">//</span>
        <span class="c1">// Code to add the resource goes here.</span>
        <span class="c1">//</span>
        <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Created</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateErrorResponse</span><span class="p">(</span>
            <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Unauthorized</span><span class="p">,</span> <span class="s">"You don't have permissions to write values."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note: As I pointed out in my last post, it is a good idea to organize code like this into a custom <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.authorizeattribute(v=vs.118).aspx">AuthorizeAttribute</a> class or some other common class so that your application logic and authorization logic are not mixed together. I’m intentionally leaving that as an exercise to you the reader though.</p><p>That’s all there is to it! Now, let’s observe the results of these changes by examining the claims collection for the authenticated user (John Doe).</p><h3 id="examining-the-group-claims">Examining the Group Claims</h3><p>I ran the application under the debugger and set a breakpoint in the POST method so I could show you the new group claims in the claims collection. As shown below, you can see there are two <em>groups</em> claims present for John Doe.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-07.png" alt="Groups Claims for John Doe" /></p><p>The value for the first groups claim should look familiar – it is the Object ID for the <em>Dev/Test</em> group I discussed earlier. The second one happens to be a <em>Developer</em> security group in my directory for which John Doe is a member. The figure here shows the membership for both security groups.</p><p><img data-proofer-ignore data-src="/assets/img/using-group-claims-in-azure-ad-08.png" alt="Security Groups for John Doe" /></p><p>Notice that John Doe is explicitly identified as a member of the Developer security group but not the Dev/Test group. Yet, in the token issued to John Doe, a group claim was present for both of these security groups. This is because the group claims feature in Azure AD is transitive. So, since John Doe is a member of the Developer group and the Developer group is a member of the Dev/Test group, John Doe is a member of both security groups.</p><p>As you can imagine, in a real world production environment a user is likely to be a member of many different security groups. When you enable the group claims feature the tokens issued for users will contain the group claims for all of these groups which could greatly increase the size of the token. Therefore, there are limits on the number of group claims that Azure AD will place in a token as follows:</p><ul><li>JWT Tokens: Up to 200 group claims<li>SAML Tokens: Up to 150 group claims</ul><p>Currently there is not a way to filter the group claims that Azure AD places in a token. So, if users in your directory could potentially exceed these limits you will need a different solution.</p><h2 id="working-with-the-azure-ad-group-claims-limit">Working with the Azure AD Group Claims Limit</h2><p>The <a href="http://msdn.microsoft.com/en-us/library/azure/hh974478.aspx">Azure AD Graph API</a> is a REST API that Azure Active Directory makes available for each tenant. With it you can programmatically access the directory and query about users, groups, contacts, tenant details and more. In addition to querying the directory, the Azure AD Graph API can be used to create, update and even delete entities in the directory.</p><p>For the scenario mentioned above, the Azure AD Graph API could be used to look up the security groups a user belongs to or to check if a user is in a specific security group. The latter is particularly applicable in our scenario here and could be achieved using the <a href="https://msdn.microsoft.com/en-us/library/azure/dn151601.aspx">IsMemberOf</a> function. To execute this query you need only the Object ID of the user and the Object ID of the security group. The query will execute in Azure AD (server side) and simply return true or false. Prior to the release of the group claims feature in Azure AD discussed in this post, this was the only way to check group membership for a user. In situations where the number of groups a user is in could potentially exceed the limits above, it is still available to you. In the next post I’ll talk more about the Azure AD Graph API.</p><h2 id="summary">Summary</h2><p>In this post I showed how to take advantage of the new Azure Active Directory group claims feature and apply it to our scenario to determine a user’s membership in a particular security group. I also discussed the group claims limit as it applies to JWT and SAML tokens issued by Azure AD and how you can fall back on the Azure AD Graph API’s <code class="language-plaintext highlighter-rouge">IsMemberOf</code> function to query the directory and determine the same.</p><p>In the next post, I will introduce you to the Azure AD Graph API and some handy client libraries you can use to access the graph in Azure AD.</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2015/02/13/using-group-claims-in-azure-active-directory/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Using Group Claims in Azure Active Directory - Rick Rainey&url=https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Using Group Claims in Azure Active Directory - Rick Rainey&u=https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Using Group Claims in Azure Active Directory - Rick Rainey&url=https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"><div class="card-body"> <span class="timeago small" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h3><div class="text-muted small"><p> Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few mi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2014/12/08/developing-native-client-apps-for-azure-active-directory/" class="btn btn-outline-primary" prompt="Older"><p>Developing Native Client Apps for Azure Active Directory</p></a> <a href="/2015/02/19/azure-redis-cache/" class="btn btn-outline-primary" prompt="Newer"><p>Azure Redis Cache</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2015/02/13/using-group-claims-in-azure-active-directory/'; this.page.identifier = '/2015/02/13/using-group-claims-in-azure-active-directory/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
