<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library" /><meta property="og:locale" content="en" /><meta name="description" content="The auto scaling feature in Windows Azure is a fantastic feature that enables you to scale your services dynamically based on a set of rules. For example, in the case of Cloud Cervices, if CPU exceeds a defined threshold in your rule, auto scaling will add additional instances to handle the increased load. When CPU drops below a defined threshold, auto scaling will remove those extra instances. It’s this kind of elasticity that makes cloud computing so compelling." /><meta property="og:description" content="The auto scaling feature in Windows Azure is a fantastic feature that enables you to scale your services dynamically based on a set of rules. For example, in the case of Cloud Cervices, if CPU exceeds a defined threshold in your rule, auto scaling will add additional instances to handle the increased load. When CPU drops below a defined threshold, auto scaling will remove those extra instances. It’s this kind of elasticity that makes cloud computing so compelling." /><link rel="canonical" href="https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/" /><meta property="og:url" content="https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-12-15T15:06:04-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2013-12-15T15:06:04-06:00","description":"The auto scaling feature in Windows Azure is a fantastic feature that enables you to scale your services dynamically based on a set of rules. For example, in the case of Cloud Cervices, if CPU exceeds a defined threshold in your rule, auto scaling will add additional instances to handle the increased load. When CPU drops below a defined threshold, auto scaling will remove those extra instances. It’s this kind of elasticity that makes cloud computing so compelling.","headline":"Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/"},"url":"https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/"}</script><title>Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 15, 2013, 3:06 PM -0600" >Dec 15, 2013<i class="unloaded">2013-12-15T15:06:04-06:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2281 words">12 min read</span></div></div><div class="post-content"><p>The auto scaling feature in Windows Azure is a fantastic feature that enables you to scale your services dynamically based on a set of rules. For example, in the case of Cloud Cervices, if CPU exceeds a defined threshold in your rule, auto scaling will add additional instances to handle the increased load. When CPU drops below a defined threshold, auto scaling will remove those extra instances. It’s this kind of elasticity that makes cloud computing so compelling.</p><p>Auto scale (currently in preview) is available for Cloud Services, Websites, and Virtual Machines. The metric for scaling on these different compute options can be based on CPU or Queue Depth as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-01.png" alt="Autoscale Cloud Services" /></p><p>Auto scale is also available for Mobile Services with some different metrics (perhaps a topic for a future post).</p><p>How to Scale an Application covers some common scenarios for configuring auto scale using the Windows Azure Management Portal. However, in this post, I’ll show how you can achieve auto scaling using the Windows Azure Monitoring Services Management Library (also in preview) instead. For the sake of time, I’m only covering Cloud Services and auto scaling based on CPU. Otherwise, this would be a massively long post. This is important because some of what I talk about does not apply to the other compute options.</p><h2 id="overview-of-my-cloud-service-application">Overview of my Cloud Service Application</h2><p>To set the stage for the application I’ll be configuring for auto scale, it is a cloud service consisting of two Web Roles configured for just 1 instance.</p><ul><li>An MVC Web Front End (the UI). This role defines the single public endpoint for the cloud service that is accessed through the browser. It simulates, in a very elementary manner, job processing. You can do two things with the UI – see status of jobs and submit a new job. When a job is submitted, it looks for available Web API instances running and round-robin posts to them through an internal endpoint.<li>An MVC Web API. This is where the job processing is done and it consumes a lot of CPU cycles. Therefore, it is this role that I will define auto scaling rules for.</ul><h2 id="introduction-to-auto-scale-profiles">Introduction to Auto Scale Profiles</h2><p>When you define auto scale settings, you’re essentially defining what’s called an AutoScaleProfile. An AutoScaleProfile contains rules, each of which has a MetricTrigger and a ScaleAction. The MetricTrigger identifies a resource (CPU for example) and some parameters for how the metric is measured and evaluated. The ScaleAction defines what to do when the conditions for the metric have been met (scale up/down for example). Basically, you have something like this.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-02.png" alt="Autoscale Cloud Services" /></p><p>This is by no means complete . It does, however, show the relationship of some basic constructs that are used in the API’s.</p><h2 id="benefits-of-using-windows-azure-monitoring-services-management-library">Benefits of using Windows Azure Monitoring Services Management Library</h2><p>By using the API’s, you can take advantage of features that may not otherwise be accessible through the portal. Here’s a list of features I came up with that I found useful.</p><ul><li>The ability to create multiple profiles. Up to 20. So, for example, I may define a profile to scale to higher capacity during one time period and another profile that scales to lower capacity during a different time window. The recent cyber-Monday comes to mind. Or, perhaps one profile during the week and another for weekends. The ability to define multiple profiles allows for some interesting possibilities.<li>The ability to set the TimeWindow property to a value other than the default of 45 minutes. The TimeWindow is a property in the MetricTrigger I mentioned above that specifies the range of time in which instance data is collected and evaluated, meaning that, by default, 45 minutes of monitoring data will have to have been collected before a MetricTrigger will result in a ScaleAction being performed. Now, you can set this value as small as 5 minutes. However, I would strongly caution against it for reasons I’ll address later. What I’ve found to be a good value for this is 25 minutes based on my testing.<li>The ability to change how the statistics for a metric are evaluated across role instances. By default, they are averaged, but I could choose to use minimum or maximum values instead.</ul><p>There are other properties that can be set using the API’s that are not surfaced in the Azure portal. These are just a few I found interesting.</p><h2 id="how-to-use-the-library-to-createupdate-read-and-delete-auto-scale-settings">How to use the library to Create/Update, Read and Delete Auto Scale Settings</h2><p>The library is available via Nuget here . If you’re looking for it in Visual Studio’s Nuget Package Manager, make sure to “Include Prerelease” when searching for “Microsoft.WindowsAzure.Management.Monitoring”.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-03.png" alt="Autoscale Cloud Services" /></p><h3 id="instantiate-an-instance-of-autoscaleclient">Instantiate an Instance of AutoscaleClient</h3><p>The AutoscaleClient is the class you make use to create, read, or delete auto scale settings. To instantiate it, you need to provide appropriate credentials which can be generated from the usual suspects – Subscription Id and Certificate. This code uses a helper class to get the management certificate from the certificate store. It also sets some variables to identify the cloud service and role I’ll apply the auto scale settings to. The latter is known as the resourceId in subsequent code.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// Cloud Service and Role to be auto scaled.</span>
<span class="kt">var</span> <span class="n">cloudServiceName</span> <span class="p">=</span> <span class="s">"[YOUR CLOUD SERVICE NAME]"</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">isProduction</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">roleName</span> <span class="p">=</span> <span class="s">"[THE ROLE NAME TO SCALE]"</span><span class="p">;</span>

<span class="c1">// Azure Subscription ID and Management Certificate Thumbprint.</span>
<span class="kt">string</span> <span class="n">subscriptionId</span> <span class="p">=</span> <span class="s">"[YOUR SUBSCRIPTION ID]"</span><span class="p">;</span>
<span class="kt">string</span> <span class="n">certThumbprint</span> <span class="p">=</span> <span class="s">"‎[YOUR CERTIFICATE THUMBPRINT]"</span><span class="p">;</span>

<span class="c1">// Get the certificate from the local store.</span>
<span class="n">X509Certificate2</span> <span class="n">cert</span> <span class="p">=</span> <span class="n">CertificateHelper</span><span class="p">.</span><span class="nf">GetCertificate</span><span class="p">(</span>
    <span class="n">StoreName</span><span class="p">.</span><span class="n">My</span><span class="p">,</span> <span class="n">StoreLocation</span><span class="p">.</span><span class="n">CurrentUser</span><span class="p">,</span> <span class="n">certThumbprint</span><span class="p">);</span>

<span class="c1">// Genereate a resource Id for the cloud service and role.</span>
<span class="kt">var</span> <span class="n">resourceId</span> <span class="p">=</span> <span class="n">AutoscaleResourceIdBuilder</span><span class="p">.</span><span class="nf">BuildCloudServiceResourceId</span><span class="p">(</span>
    <span class="n">cloudServiceName</span><span class="p">,</span> <span class="n">roleName</span><span class="p">,</span> <span class="n">isProduction</span><span class="p">);</span>

<span class="c1">// Create the autoscale client.</span>
<span class="n">AutoscaleClient</span> <span class="n">autoscaleClient</span> <span class="p">=</span>
   <span class="k">new</span> <span class="nf">AutoscaleClient</span><span class="p">(</span><span class="k">new</span> <span class="nf">CertificateCloudCredentials</span><span class="p">(</span><span class="n">subscriptionId</span><span class="p">,</span> <span class="n">cert</span><span class="p">));</span>
</pre></table></code></div></div><h3 id="create-an-autoscale-profile">Create an Autoscale Profile</h3><p>Using the psuedo-code above as reference, the code here shows how to create a profile. Notice there are some other settings here like ScaleCapacity where you can define minimum, maximum, and default capacity limits for scaling.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="n">AutoscaleSettingCreateOrUpdateParameters</span> <span class="n">createParams</span> <span class="p">=</span>
    <span class="k">new</span> <span class="nf">AutoscaleSettingCreateOrUpdateParameters</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Setting</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">AutoscaleSetting</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Enabled</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">Profiles</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">AutoscaleProfile</span><span class="p">&gt;()</span> 
            <span class="p">{</span>
                <span class="k">new</span> <span class="nf">AutoscaleProfile</span><span class="p">()</span>
                <span class="p">{</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">"Scale.WebApi.Cpu"</span><span class="p">,</span>
                    <span class="n">Capacity</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScaleCapacity</span><span class="p">()</span>
                    <span class="p">{</span>
                        <span class="n">Default</span> <span class="p">=</span> <span class="s">"1"</span><span class="p">,</span>
                        <span class="n">Minimum</span> <span class="p">=</span> <span class="s">"1"</span><span class="p">,</span>
                        <span class="n">Maximum</span> <span class="p">=</span> <span class="s">"4"</span>
                    <span class="p">},</span>
                    <span class="n">Rules</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">ScaleRule</span><span class="p">&gt;()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>
</pre></table></code></div></div><h3 id="create-a-scalerule-to-scale-up">Create a ScaleRule to Scale Up</h3><p>Again, using the psuedo-code above as a reference, this code creates the first of two ScaleRule instances. The rule contains a MetricTrigger and a ScaleAction to scale up the instances (WebApi in this case) when the average CPU exceeds 40% across all instances.</p><p>A few things to point out about this code are…</p><ul><li>The MetricName and MetricNamespace are not values I just made up. These have to be precise. You can get these values from the MetricsClient API and there is some sample code in this link to show how to get the values.<li>The TimeWindow is set to 25 minutes. As I indicated earlier, the default for this is 45 minutes. My experience has been intermittent with a value of 20 minutes or less. So, I recommend at least 25 minutes for this value. I’ll come back to this later.</ul><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">cpuScaleUpRule</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScaleRule</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Define the MetricTrigger Properties</span>
    <span class="n">MetricTrigger</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MetricTrigger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">MetricName</span> <span class="p">=</span> <span class="s">"Percentage CPU"</span><span class="p">,</span>
        <span class="n">MetricNamespace</span> <span class="p">=</span> <span class="s">""</span><span class="p">,</span>
        <span class="n">MetricSource</span> <span class="p">=</span> <span class="n">AutoscaleMetricSourceBuilder</span><span class="p">.</span><span class="nf">BuildCloudServiceMetricSource</span><span class="p">(</span><span class="n">cloudServiceName</span><span class="p">,</span> <span class="n">roleName</span><span class="p">,</span> <span class="n">isProduction</span><span class="p">),</span>
        <span class="n">TimeGrain</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">5</span><span class="p">),</span>
        <span class="n">TimeWindow</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">25</span><span class="p">),</span>
        <span class="n">TimeAggregation</span> <span class="p">=</span> <span class="n">TimeAggregationType</span><span class="p">.</span><span class="n">Average</span><span class="p">,</span>
        <span class="n">Statistic</span> <span class="p">=</span> <span class="n">MetricStatisticType</span><span class="p">.</span><span class="n">Average</span><span class="p">,</span>
        <span class="n">Operator</span> <span class="p">=</span> <span class="n">ComparisonOperationType</span><span class="p">.</span><span class="n">GreaterThan</span><span class="p">,</span>
        <span class="n">Threshold</span> <span class="p">=</span> <span class="m">40.0</span>
    <span class="p">},</span>
    <span class="c1">// Define the ScaleAction Properties</span>
    <span class="n">ScaleAction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScaleAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Direction</span> <span class="p">=</span> <span class="n">ScaleDirection</span><span class="p">.</span><span class="n">Increase</span><span class="p">,</span>
        <span class="n">Type</span> <span class="p">=</span> <span class="n">ScaleType</span><span class="p">.</span><span class="n">ChangeCount</span><span class="p">,</span>
        <span class="n">Value</span> <span class="p">=</span> <span class="s">"1"</span><span class="p">,</span>
        <span class="n">Cooldown</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="create-a-scalerule-to-scale-down">Create a ScaleRule to Scale Down</h3><p>Similar to the previous rule, this rule contains a MetricTrigger and ScaleAction to scale down the instances when the average CPU falls below 25% across all instances.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">cpuScaleDownRule</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScaleRule</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Define the MetricTrigger Properties</span>
    <span class="n">MetricTrigger</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MetricTrigger</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">MetricName</span> <span class="p">=</span> <span class="s">"Percentage CPU"</span><span class="p">,</span>
        <span class="n">MetricNamespace</span> <span class="p">=</span> <span class="s">""</span><span class="p">,</span>
        <span class="n">MetricSource</span> <span class="p">=</span> <span class="n">AutoscaleMetricSourceBuilder</span><span class="p">.</span><span class="nf">BuildCloudServiceMetricSource</span><span class="p">(</span><span class="n">cloudServiceName</span><span class="p">,</span> <span class="n">roleName</span><span class="p">,</span> <span class="n">isProduction</span><span class="p">),</span>
        <span class="n">TimeGrain</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">5</span><span class="p">),</span>
        <span class="n">TimeWindow</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">25</span><span class="p">),</span>
        <span class="n">TimeAggregation</span> <span class="p">=</span> <span class="n">TimeAggregationType</span><span class="p">.</span><span class="n">Average</span><span class="p">,</span>
        <span class="n">Statistic</span> <span class="p">=</span> <span class="n">MetricStatisticType</span><span class="p">.</span><span class="n">Average</span><span class="p">,</span>
        <span class="n">Operator</span> <span class="p">=</span> <span class="n">ComparisonOperationType</span><span class="p">.</span><span class="n">LessThan</span><span class="p">,</span>
        <span class="n">Threshold</span> <span class="p">=</span> <span class="m">25.0</span>
    <span class="p">},</span>
    <span class="c1">// Define the ScaleAction Properties</span>
    <span class="n">ScaleAction</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ScaleAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Direction</span> <span class="p">=</span> <span class="n">ScaleDirection</span><span class="p">.</span><span class="n">Decrease</span><span class="p">,</span>
        <span class="n">Type</span> <span class="p">=</span> <span class="n">ScaleType</span><span class="p">.</span><span class="n">ChangeCount</span><span class="p">,</span>
        <span class="n">Value</span> <span class="p">=</span> <span class="s">"1"</span><span class="p">,</span>
        <span class="n">Cooldown</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></table></code></div></div><h3 id="create-or-update-auto-scale-settings">Create or Update Auto Scale Settings</h3><p>Finally, to create (or update existing settings), all that is left is to add the rules to the profile and call the CreateOrUpdate method to apply the settings for the resource.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// Add the rules to the profile</span>
<span class="n">createParams</span><span class="p">.</span><span class="n">Setting</span><span class="p">.</span><span class="n">Profiles</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Rules</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">cpuScaleUpRule</span><span class="p">);</span>
<span class="n">createParams</span><span class="p">.</span><span class="n">Setting</span><span class="p">.</span><span class="n">Profiles</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Rules</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">cpuScaleDownRule</span><span class="p">);</span>

<span class="c1">// Apply the settings in Azure to this resource</span>
<span class="n">autoscaleClient</span><span class="p">.</span><span class="n">Settings</span><span class="p">.</span><span class="nf">CreateOrUpdate</span><span class="p">(</span><span class="n">resourceId</span><span class="p">,</span> <span class="n">createParams</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="get-auto-scale-settings">Get Auto Scale Settings</h3><p>To retrieve existing auto scale settings for a particular resource, you just need to call Get, passing in the resourceId. The AutoscaleSettingGetResponse will have all the goodness in it that we just went through to create the the settings.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">AutoscaleSettingGetResponse</span> <span class="n">setting</span> <span class="p">=</span> <span class="n">autoscaleClient</span><span class="p">.</span><span class="n">Settings</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">resourceId</span><span class="p">);</span>
</pre></table></code></div></div><h3 id="delete-auto-scale-settings">Delete Auto Scale Settings</h3><p>To delete existing auto scale settings just call Delete, passing in the resourceId.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">deleteResponse</span> <span class="p">=</span> <span class="n">autoscaleClient</span><span class="p">.</span><span class="n">Settings</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">resourceId</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="observations-of-a-running-application-configured-for-auto-scale">Observations of a Running Application Configured for Auto Scale</h2><p>With these auto scale settings in place, I decided to take my MVC and CPU consuming Web Api for a test drive to see this in action.</p><p>I started by going to my MVC page and submitting a couple of “jobs” over the span of about 10 minutes. And as you can see here, my CPU is certainly climbing and quickly I’m above my 40% threshold.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-04.png" alt="Autoscale Cloud Services" /></p><p>As expected, after 25 minutes of average CPU above 40%, I saw my WebApi role spin up a 2nd instance.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-05.png" alt="Autoscale Cloud Services" /></p><p>Once the instance was ready, I threw a couple more jobs at it. The home page for my MVC front end displays the results of all the jobs and also which instance serviced (or is servicing them). My MVC front end is dispatching these jobs in round-robin fashion to the available WebApi instances.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-06.jpg" alt="Autoscale Cloud Services" /></p><p>Continuing with this pattern, I saw another instance get created about 15 minutes later.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-07.png" alt="Autoscale Cloud Services" /></p><p>And I continued to throw a few more jobs at the system. So, now I have 5 jobs being worked across 3 instances.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-08.jpg" alt="Autoscale Cloud Services" /></p><p>The timeline for the scale up actions is below and shows when my instances were created and the effect they had on the average CPU for WebApi while I continued to throw jobs at the system.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-09.png" alt="Autoscale Cloud Services" /></p><p>What I didn’t show is the scale down behavior that occurred after I stopped loading the system up with work. Over the course of another 20 minutes or so, the WebApi instances dropped back down to the single instance I started with.</p><h2 id="caution-about-setting-the-time-window">Caution About Setting the Time Window</h2><p>When I first learned about the TimeWindow property and the default value of 45 minutes, I immediately elected to use the API’s to set this to as small a number as allowed by the API (which is 5 minutes). After all, if my service is getting hammered, I would prefer that it scale right away instead of wait for 45 minutes to do so. Unfortunately, when I did this I started seeing messages like this in the Azure Portal with no scale actions being invoked.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-10.png" alt="Autoscale Cloud Services" /></p><p>What I’ve learned is that the gap between the current time and the last data point that you can see in the MONITORING page is part of that TimeWindow. So, consider for example the scenario below where it may be 8:43 but the last data point available was at 8:30. That’s a 13 minute gap in time. Defining a TimeWindow of 5 minutes would result in the warning above because there was no monitoring data points in the last 5 minutes ( between 8:38 and 8:43 ) when auto scale was trying to evaluate the MetricTrigger.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-11.png" alt="Autoscale Cloud Services" /></p><p>This lag in monitoring data and current time is common and the lag time is unpredictable. It might be 10 minutes during part of the day and 20 minutes at another. In my testing, I’ve found that 25 minutes is a safe value for TimeWindow.</p><p>So, experiment with this setting to find the value that works for you if you choose to deviate from the default of 45 minutes.</p><h2 id="examining-the-operating-logs">Examining the Operating Logs</h2><p>Anytime you change auto scale settings an AutoscaleAction is invoked. You can see the details of such changes in the Azure Portal. Click on the MANAGEMENT SERVICES section. Next, click on a particular log and click on the DETAILS link at the bottom to see the changes. I’ve found this to be very helpful when testing out various profile settings.</p><p><img data-proofer-ignore data-src="/assets/img/autoscale-cs-12.png" alt="Autoscale Cloud Services" /></p><h2 id="conclusion">Conclusion</h2><p>There is so much more to auto scaling that I’ve not even mentioned. As long as this post is, it’s hard to believe I’ve just barely scratched the surface. Hopefully this has helped you understand a little more about auto scale for cloud services, the Windows Azure Monitoring Services Management Library, and the benefits of using it to automate your auto scale settings.</p><p>The Service Management REST API for Autoscaling provides documentation that at the time of this writing wasn’t available in the .NET API’s that I wrote about. Even if you don’t use the REST API’s, referring to them for documentation is a good idea.</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library - Rick Rainey&url=https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library - Rick Rainey&u=https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Auto Scaling Cloud Services on CPU Percentage with the Windows Azure Monitoring Services Management Library - Rick Rainey&url=https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"><div class="card-body"> <span class="timeago small" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h3><div class="text-muted small"><p> Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few mi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2013/12/11/it-works-fine-in-the-windows-azure-emulator-but-fails-when-i-publish-to-windows-azure/" class="btn btn-outline-primary" prompt="Older"><p>It works fine in the Windows Azure Emulator but fails when I publish to Windows Azure</p></a> <a href="/2014/01/21/continuous-deployment-github-with-azure-web-sites-and-staged-publishing/" class="btn btn-outline-primary" prompt="Newer"><p>Continuous Deployment (GitHub) with Azure Web Sites and Staged Publishing</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/'; this.page.identifier = '/2013/12/15/auto-scaling-cloud-services-on-cpu-percentage-with-the-windows-azure-monitoring-services-management-library/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
