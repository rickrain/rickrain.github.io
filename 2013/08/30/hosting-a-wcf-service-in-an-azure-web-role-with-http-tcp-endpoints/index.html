<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Hosting a WCF Service in an Azure Web Role with HTTP &amp; TCP Endpoints" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/" /><meta property="og:url" content="https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2013-08-30T16:06:04-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hosting a WCF Service in an Azure Web Role with HTTP &amp; TCP Endpoints" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2013-08-30T16:06:04-05:00","description":"Introduction","headline":"Hosting a WCF Service in an Azure Web Role with HTTP &amp; TCP Endpoints","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/"},"url":"https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/"}</script><title>Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 30, 2013, 4:06 PM -0500" >Aug 30, 2013<i class="unloaded">2013-08-30T16:06:04-05:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1860 words">10 min read</span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><p>Since IIS 7.5, developers have been able to take advantage of the rich hosting environment IIS provides for their WCF services, and do so using non-http protocols, such as net.tcp, net.pipe (for x-process calls), and net.msmq (for queuing). For many, it was this release that removed the ball-and-chain of writing and maintaining a self-hosted WCF service host just to leverage non-http protocols. Extending this concept to the cloud and hosting your WCF service in an Azure Web Role allows you to continue to benefit from the great hosting features in IIS. It is a very simple task, if you just stick with the defaults (http). Add support for tcp and things can start to get a bit tricky.</p><p>In this post, I’m going to walk through the steps to host a WCF service in an Azure Web Role that supports both http and tcp protocols. I will also share my approach to web service development along the way.</p><h2 id="create-a-wcf-service-library">Create a WCF Service Library</h2><p>I prefer to start just about any WCF service using the WCF Service Library template.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-01.png" alt="Hosting WCF" /></p><p>There are a few reasons for this…</p><ul><li>The project is configured to leverage the WCFServiceHost. This frees me from having to provide a host process of my own. If you’ve done WCF development for a while, you probably remember the days of the console host application you had to write just so you could test your service. Sadly, many of those samples are still around today. I don’t like these because they just take away from what is strategic, which is, developing the service!<li>The project is configured to launch the WCFTestClient. This frees me from having to provide a client application of my own just to test the functionality of my service. Again, not strategic to what I’m trying to do.<li>Finally, and this is the most important, the project makes absolutely no assumption about how the service will be hosted. I can reference this DLL from any host process I choose (IIS, a Windows Service, COM+, etc.) and that host can be on-premise or in the cloud.</ul><p>As a result, I spend my time focusing on just the implementation of my service. Once I’m satisfied with my implementation, I can shift my attention to the tasks needed to host it.</p><p>For this blog post, I used the WCF Service Library template to create a calculator service. I’m not going to go into the details here because this is a very trivial step and not the focus of this post. It literally took about 60 seconds and I was up and running. If you’re reading this I’m assuming you know the basics of creating a WCF service. My full solution is also available at the end of this post for download.</p><h2 id="create-a-cloud-service-using-the-wcf-service-web-role">Create a Cloud Service using the WCF Service Web Role</h2><p>My calculator service needs a host process and since I’m going to host this service in Azure, I used the WCF Service Web Role template for my new Cloud Service project.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-02.png" alt="Hosting WCF" /></p><p>Using this template assumes you will be using IIS as your host. This is recommended because of all the features that IIS makes available to you out of the box. Again, what is strategic for me is not creating a service host but instead making my service (from the previous section) available to clients or other applications. In other words, I’m simply leveraging as many features of the platform as possible so I don’t have to maintain unnecessary code.</p><p>When Visual Studio creates the WCF Service Web Role project, it provides a fully functional service you can use to start your development from. Since I already have a service though I deleted these files from the project.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-03.png" alt="Hosting WCF" /></p><p>Even if I were planning to start my development from this template, I always delete these files because I don’t like the physical .svc file that has just one line of markup in it. This .svc file (the extension actually) is significant though because it is what IIS uses to activate the service. So, removing it means I need to handle this another way, which I’ll get to shortly.</p><p>The main issue I have with the .svc file though is this. If you decide to add more services to your Web Role, then you would end up with more .svc files in your virtual directory. Imagine what your virtual directory in IIS would look like if you had hundreds of services. You guessed it – you would have hundreds of .svc files (each with just one line of markup in it).</p><p>There is a better way to handle activation of your service that will free your virtual directory from the clutter of .svc files. And if your going to run your service on-premise or in an IaaS Virtual Machine in Azure, your IT Professional will appreciate not having all these files in the directory too!</p><p>To achieve this, I just need to do three simple things:</p><ul><li>Add a project reference (not a service reference) to my WebRole referencing the WCF Service Library from the previous section.<li>Build the solution so the DLL for my WCF Service Library (referenced in #1) is in the output directory of my Web Role.<li>Add a serviceActivation to the configuration (web.config) for the Web Role. The Relative Address can be anything, just as long as it ends with “.svc”. Again, this is because IIS uses this to broker in the correct handlers for WCF. The Service is the service type from the WCF Service Library. That is, the class that implements the service contract.</ul><p><img data-proofer-ignore data-src="/assets/img/host-wcf-04.png" alt="Hosting WCF" /></p><p>That’s it. Now, I can build and publish the solution to Azure. To interact with the service, I prefer to continue using the WCFTestClient that I used during the development of the service. In fact, I just keep it on my task bar for easy access to just about any service I want to test. Here is where it is located on a Visual Studio 2013 installation.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-05.png" alt="Hosting WCF" /></p><p>To consume the service, open the service using the public address of the cloud service and append the relative address from the serviceActivation configured earlier and you’re up and running.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-06.png" alt="Hosting WCF" /></p><h2 id="provision-the-virtual-machine-to-support-tcp">Provision the Virtual Machine to Support TCP</h2><p>When you host your service in IIS, your service is accessed through the base addresses the environment has provisioned . By default, there is only one base address, and it uses http . So, the base address for your service is http://[yourservicename].cloudapp.net/calc.svc . If you want to support tcp, then you need to provision the environment so that IIS offers a base address for it. When you do, you will automatically have a base address for that protocol, such as net.tcp://[yourservicename].cloudapp.net/calc.svc .</p><p>To provision the server so that IIS support TCP requires some server configuration changes. There is plenty of documentation showing how to install and configure non-http activation on a server. But, when you’re deploying your service to Azure, you need to automate this.</p><p>To automate this step, I added a Startup folder to my Web Role project with two files.</p><ol><li>A Startup.cmd that I’ll run as a startup task when the virtual machine is being provisioned.<li>A PowerShell script, RoleStart.ps1, that I’ll run from the OnStart method in my Web Role.</ol><p>The reason for not putting all this in a single startup task is explained here .</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-07.png" alt="Hosting WCF" /></p><h2 id="startupcmd">Startup.cmd</h2><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Powershell.exe</span><span class="w"> </span><span class="nt">-command</span><span class="w"> </span><span class="s2">"Set-ExecutionPolicy -ExecutionPolicy Unrestricted"</span><span class="w"> </span><span class="err">&gt;&gt;</span><span class="w"> </span><span class="nx">startup_log.txt</span><span class="w">
</span></pre></table></code></div></div><p>This will get executed as a startup task. All it does is set the execution policy to Unrestricted so I can run the RoleStart.ps1 later in the OnStart method.</p><h2 id="rolestartupps1">RoleStartup.ps1</h2><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c"># Install TCP Activation to support netTcpBinding.</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">ServerManager</span><span class="w">
</span><span class="n">Install-WindowsFeature</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">AS-TCP-Activation</span><span class="w">
 
</span><span class="c"># Add TCP to site bindings.</span><span class="w">
</span><span class="c"># Assume the fist website is for my WebRole.</span><span class="w">
</span><span class="n">Import-Module</span><span class="w"> </span><span class="nx">WebAdministration</span><span class="w">
</span><span class="nv">$site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-WebSite</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-First</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span><span class="n">Set-Alias</span><span class="w"> </span><span class="nx">appcmd</span><span class="w"> </span><span class="nv">$</span><span class="nn">env</span><span class="p">:</span><span class="nv">windir</span><span class="nx">\system32\inetsrv\appcmd.exe</span><span class="w">
</span><span class="n">appcmd</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">site</span><span class="w"> </span><span class="s2">""</span><span class="nv">$site</span><span class="o">.</span><span class="nf">Name</span><span class="s2">""</span><span class="w"> </span><span class="s2">"-+bindings.[protocol='net.tcp',bindingInformation='808:*']"</span><span class="w">
 
</span><span class="c"># Enable net.tcp on protocol.</span><span class="w">
</span><span class="nv">$appName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$site</span><span class="o">.</span><span class="nf">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">"/"</span><span class="w">
</span><span class="n">appcmd</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="nv">$appName</span><span class="w"> </span><span class="s2">"/enabledProtocols:http,net.tcp"</span><span class="w">
</span></pre></table></code></div></div><p>This script provisions the server to install the TCP Activation Windows feature, add TCP site bindings in IIS, and then enable net.tcp on the site. It will get executed from the OnStart method when the Web Role is starting which I’ll get to shortly.</p><p>A word of caution regarding these two files. They need to be saved using codepage 65001 instead of the default 1252. Otherwise, they will fail because of some encoding discrepancies at the beginning of the file. To do this, select File –&gt; Advanced Save Options if/when you edit these in Visual Studio.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-08.png" alt="Hosting WCF" /></p><p>The next step is to edit the service definition (.csdef) file. Here, I’ll make two changes:</p><p>Set the executionContext in for the Runtime to elevated. This is because I’m going to be invoking the RoleStart.ps1 PowerShell script in my OnStart method. Since that script will be making server configuration changes, the Web Role needs to be elevated for that to be successful.</p><p>Add a Startup Task to invoke the Startup.cmd during the virtual machine provisioning process.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-09.png" alt="Hosting WCF" /></p><h2 id="webrolecs">WebRole.cs</h2><p>Finally, the last part of the provisioning process is to invoke the RoleStart.ps1 PowerShell script in the OnStart method. Here is the snippet of code that starts a new PowerShell process and invokes the script.</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span text-data=" C# "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kt">var</span> <span class="n">startInfo</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ProcessStartInfo</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">FileName</span> <span class="p">=</span> <span class="s">"powershell.exe"</span><span class="p">,</span>
    <span class="n">Arguments</span> <span class="p">=</span> <span class="s">@"..\Startup\RoleStart.ps1"</span><span class="p">,</span>
    <span class="n">RedirectStandardOutput</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
    <span class="n">UseShellExecute</span> <span class="p">=</span> <span class="k">false</span>
<span class="p">};</span>

<span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamWriter</span><span class="p">(</span><span class="s">"out.txt"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">process</span> <span class="p">=</span> <span class="n">Process</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="n">startInfo</span><span class="p">);</span>
<span class="n">process</span><span class="p">.</span><span class="nf">WaitForExit</span><span class="p">();</span>
<span class="n">writer</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="n">process</span><span class="p">.</span><span class="n">StandardOutput</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">());</span>
<span class="n">writer</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
</pre></table></code></div></div><h2 id="configure-the-wcf-service-web-role-to-use-tcp">Configure the WCF Service Web Role to use TCP</h2><p>There are just a few configuration changes that need to be added to the WCF Service to round this out. The first is to add the useRequestHeadersForMetadataAddress Service behavior and defaultPort property setting for net.tcp. The port is 808, which is the port used in the RoleStart.ps1 script to configure site bindings for net.tcp. This will make your service work behind the Azure load balancer.</p><p>http://support.microsoft.com/kb/971842</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-10.png" alt="Hosting WCF" /></p><p>Next, I’m going to disable security on the netTcpBinding. By default, it uses Transport Security. Since my http endpoint is also not secure (yet), I’m just disabling it for tcp as well. In a follow-up post, I’ll cover the steps to secure these two endpoints.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-11.png" alt="Hosting WCF" /></p><p>With the netTcpBinding configuration taken care of, the next step is to wire this up to the ProtocolMapping for net.tcp.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-12.png" alt="Hosting WCF" /></p><h2 id="add-a-tcp-endpoint-to-the-cloud-service">Add a TCP Endpoint to the Cloud Service</h2><p>The last part is to add a new input endpoint to the cloud service project.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-13.png" alt="Hosting WCF" /></p><p>Now, build and publish the solution and you will have a WCF Service running in a Web Role accessible through either http or tcp endpoints.</p><h2 id="test-the-cloud-service">Test the Cloud Service</h2><p>Using the WCFTestClient again to test the service, I now have two endpoints; one using http and another using tcp.</p><p><img data-proofer-ignore data-src="/assets/img/host-wcf-14.png" alt="Hosting WCF" /></p><h2 id="conclusion">Conclusion</h2><p>In this post I showed how to host a WCF Service in an Azure Web Role with support for http and tcp protocols. I also covered some of my personal best practices on how to build your WCF service to accommodate various hosting options.</p><p>As always, my full source code is available <a href="https://github.com/rickrain/WCF-In-Azure-WebRole">here</a>.</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints - Rick Rainey&url=https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints - Rick Rainey&u=https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hosting a WCF Service in an Azure Web Role with HTTP & TCP Endpoints - Rick Rainey&url=https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"><div class="card-body"> <span class="timeago small" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h3><div class="text-muted small"><p> Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few mi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2013/07/27/visual-studio-and-gitub-the-basics-of-working-with-existing-repositories-2/" class="btn btn-outline-primary" prompt="Older"><p>Visual Studio and GitHub: The Basics of Working with Existing Repositories</p></a> <a href="/2013/09/18/securing-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints-2/" class="btn btn-outline-primary" prompt="Newer"><p>Securing a WCF Service in an Azure Web Role with HTTP & TCP Endpoints</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/'; this.page.identifier = '/2013/08/30/hosting-a-wcf-service-in-an-azure-web-role-with-http-tcp-endpoints/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
