<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Add a custom device to the Azure IoT Suite Remote Monitoring solution" /><meta property="og:locale" content="en" /><meta name="description" content="Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few minutes, enabling you to get hands-on with all the services that comprise a typical IoT solution. If you have never seen the solutions in IoT Suite, I encourage you to check them out. They will accelerate your learnings on how the plethora of services in Azure can be used to implement an IoT solution that provides telemetry ingestion at massive scale, data storage, analytics, and presentation of data. I lean on these solutions a lot when talking to customers about IoT on Azure as well as the Azure IoT Reference Architecture. And best of all, these solutions are open sourced on GitHub so you can fork them and use them as a starting point to build your own IoT solutions." /><meta property="og:description" content="Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few minutes, enabling you to get hands-on with all the services that comprise a typical IoT solution. If you have never seen the solutions in IoT Suite, I encourage you to check them out. They will accelerate your learnings on how the plethora of services in Azure can be used to implement an IoT solution that provides telemetry ingestion at massive scale, data storage, analytics, and presentation of data. I lean on these solutions a lot when talking to customers about IoT on Azure as well as the Azure IoT Reference Architecture. And best of all, these solutions are open sourced on GitHub so you can fork them and use them as a starting point to build your own IoT solutions." /><link rel="canonical" href="https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/" /><meta property="og:url" content="https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-06-22T16:06:04-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Add a custom device to the Azure IoT Suite Remote Monitoring solution" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2016-06-22T16:06:04-05:00","description":"Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few minutes, enabling you to get hands-on with all the services that comprise a typical IoT solution. If you have never seen the solutions in IoT Suite, I encourage you to check them out. They will accelerate your learnings on how the plethora of services in Azure can be used to implement an IoT solution that provides telemetry ingestion at massive scale, data storage, analytics, and presentation of data. I lean on these solutions a lot when talking to customers about IoT on Azure as well as the Azure IoT Reference Architecture. And best of all, these solutions are open sourced on GitHub so you can fork them and use them as a starting point to build your own IoT solutions.","headline":"Add a custom device to the Azure IoT Suite Remote Monitoring solution","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"},"url":"https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"}</script><title>Add a custom device to the Azure IoT Suite Remote Monitoring solution | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Add a custom device to the Azure IoT Suite Remote Monitoring solution</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 22, 2016, 4:06 PM -0500" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2233 words">12 min read</span></div></div><div class="post-content"><p>Today, <a href="https://azure.microsoft.com/en-us/documentation/articles/iot-suite-overview/">Azure IoT Suite</a> provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few minutes, enabling you to get hands-on with all the services that comprise a typical IoT solution. If you have never seen the solutions in IoT Suite, I encourage you to check them out. They will accelerate your learnings on how the plethora of services in Azure can be used to implement an IoT solution that provides telemetry ingestion at massive scale, data storage, analytics, and presentation of data. I lean on these solutions a lot when talking to customers about IoT on Azure as well as the <a href="https://azure.microsoft.com/en-us/updates/microsoft-azure-iot-reference-architecture-available/">Azure IoT Reference Architecture</a>. And best of all, these solutions are open sourced on GitHub so you can fork them and use them as a starting point to build your own IoT solutions.</p><p>In this blog post, I’m going to be using the Remote Monitoring solution to show how you can register a custom device with IoT Hub to send real telemetry (temperature and humidity) data to IoT Hub. I’m not going to go deep into the solution itself. You can do that at your own convenience. This post is all about taking an Azure IoT Starter Kit and connecting it to the solution so you can explore the possibilities of devices in a working solution.</p><p>The <a href="https://azure.microsoft.com/en-us/develop/iot/starter-kits/">Microsoft Azure IoT Starter Kits</a> provide a variety of boards, sensors, and controls that you can use to get started with IoT in Azure. The one I’m using for this post is the Adafruit Feather M0 Starter Kit shown here from the Azure IoT Starter Kits page. As you can see, it is packed full of gadgets and can take your mind far beyond the scenario I’ll discuss in this post. BTW, this is not an endorsement of any kind. It is the starter kit that was available to me. If you decide to purchase a kit, explore them all and pick the one that best meets your needs. They are all certified for Azure!</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-01.png" alt="Adafruit Feather M0 Starter Kit" /></p><p>The getting started page for the Adafruit Feather M0 WiFi starter kit is a good place to start and if you are persistent you will find everything you need to be successful. However, one of the reasons I chose to write this blog is to consolidate all the steps into a single document. I spent hours on what I thought would be a rather trivial process and made some mistakes along the way. Also, because the device manufacturer, the IDE, and the Azure platform span different organizations, the documentation tends to be a bit fragmented as you dive deeper into things. So, my goal here is to document a clear and concise path to connecting a custom device to the remote monitoring solution. Specifically, in this post I will show how to</p><ul><li>build a device that can transmit temperature and humidity data to Azure IoT Hub,<li>configure the Arduino IDE used to compile and upload code to the device,<li>deploy the remote monitoring solution from the Azure IoT Suite,<li>register the device in IoT Hub,<li>compile and upload the remote monitoring device code to the device,<li>observe the telemetry data from the device in the remote monitoring solution.</ul><h2 id="build-the-device">Build the device</h2><p>The first step in this process was to build the device to connect to the remote monitoring solution. For this, you need the breadboard, some wires, the BME280 sensor (barometric pressure, temperature, and humidity), and the main Adafruit Feather M0 WiFi module. This was a lot of fun for me personally. The last time I did anything involving a breadboard was back in 19xx when I was in college. It was a rewarding experience back then and a lot of fun xx years later in an internet-of-things (IoT) world. I used this opportunity to expose my youngest son to circuitry and IoT. In fact, he built the device referenced in this section of the post.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-02.png" alt="Breadboard and sensors" /></p><p>First up, install the Adafruit module and BME280 sensor on the board. Placement on the board is not important. You just need to give yourself some room to work.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-03.png" alt="Breadboard and sensors" /></p><p>Wire up the power (3Vo) and ground (GND) as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-04.png" alt="Breadboard and sensors" /></p><p>Next, wire up the BME280 sensor. I tried a couple of wiring configurations (I2C and SPI) and eventually settled on the Serial Peripheral Interface (SPI) wiring configuration. What is shown here is the clock (SCK), data out (SDO), data in (SDI), and chip select (CS) from the BME280 connected to pins 13, 12, 11, and 10 on the main module.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-05.png" alt="Breadboard and sensors" /></p><p>Later, we will test this out, but first, we need to setup the development environment so we can program the device.</p><h2 id="setup-the-arduino-ide">Setup the Arduino IDE</h2><p>To program the device, you need the Arduino IDE. Specifically, for the Azure IoT Suite Remote Monitoring Solution, it is advised that you use version 1.6.8 or newer. For this post, I used the Windows version 1.6.9.</p><blockquote><p>Note: I also tested things out on the Mac version and it worked equally as well.</p></blockquote><p>After installing the Arduino IDE, run the IDE and select <strong>File -&gt; Preferences</strong>. Set the Additional Boards Manager URLS to <code class="language-plaintext highlighter-rouge">https://adafruit.github.io/arduino-board-index/package_adafruit_index.json</code> and click OK. This is used by the IDE’s Board Manager to locate new/updated Adafruit boards.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-06.png" alt="Arduino preferences" /></p><p>Next, using the Boards Manager, install the Arduino SAMD Boards and Adafruit SAMD Boards as shown here. To open the Boards Manager, select <strong>Tools -&gt; Boards Manager</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-07.png" alt="Arduino Boards Manager" /></p><p>Close and re-open the Arduino Software IDE.</p><p>If you are running on Windows, as I was while writing this post, then you will want to also install the Adafruit Board Drivers. A link to the installer is available <a href="https://learn.adafruit.com/adafruit-feather-m0-wifi-atwinc1500/using-with-arduino-ide">here</a> (near the middle of the page). I used the default settings to install the drivers on my machine.</p><p>Finally, select <strong>Tools -&gt; Board</strong>, and then select the <em>Adafruit Feather M0</em> board as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-08.png" alt="Adafruit Feather M0" /></p><p>Using the Library Manager, install the <em>Adafruit BME280</em>, <em>Adafruit Unified Sensor</em>, and <em>RTCZero libraries</em> as shown here. To open the Library Manager, select <strong>Sketch -&gt; Include Library -&gt; Manage Libraries</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-09.png" alt="Library Manager" /></p><p>There are two more libraries you need for this solution that you have to download and copy to your Arduino Library folder manually.</p><ol><li>Clone (or download) the <a href="https://github.com/adafruit/Adafruit_WINC1500">Adafruit WINC1500 library</a>.<li>Clone (or download) the <a href="https://github.com/Azure/azure-iot-arduino">Azure IoT Hub for Arduino Library</a>.</ol><p>Copy both libraries to the <code class="language-plaintext highlighter-rouge">Documents\Arduino\libraries</code> folder. The Arduino libraries folder now contains the five libraries installed above as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-10.png" alt="Arduino libraries" /></p><h2 id="test-the-device">Test the device</h2><p>At this stage you are ready to test out some basic functions on the board, such as the blink sample sketch. To do this, plug the device into a USB port and wait about 30 seconds.</p><p>In the Arduino Software IDE, select <strong>Tools -&gt; Ports -&gt; [port for the device]</strong> as shown here (your COM port may be different).</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-11.png" alt="Arduino ports" /></p><p>Next, compile <strong>(CTRL + R)</strong> and then upload <strong>(CTRL + U)</strong> the blink sketch to the device. After a few seconds the red light on the device will start blinking on/off per the code in the sketch.</p><blockquote><p>Note: The device needs to be reset before you can upload a new sketch to it. To do this, press the reset button 2 times, reconfigure your port setting in the Arduino IDE, and then upload the sketch.</p></blockquote><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-12.png" alt="Blinking device" /></p><h2 id="deploy-the-azure-iot-suite-remote-monitoring-solution">Deploy the Azure IoT Suite Remote Monitoring Solution</h2><p>To deploy the Remote Monitoring Solution from the Azure IoT Suite, open a browser and navigate to https://azureiotsuite.com. Sign-in using the same credentials you use to sign-in to the Azure portal.</p><p>Click the link to <strong>Create a new solution</strong>.</p><p>Select the <strong>Remote Monitoring Solution</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-13.png" alt="Azure IoT Suite Preconfigured Solutions" /></p><p>Enter a solution name, select a region, select your subscription you want the solution deployed in, and then click <strong>Create Solution</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-14.png" alt="Remote Monitoring Solution Details" /></p><p>The solution takes about 10 minutes to deploy. After it does, launch the dashboard (ie: web app) for the solution by clicking <strong>Launch</strong> on the solution as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-15.png" alt="Launch Remote Monitoring Solution" /></p><h2 id="create-a-custom-device-id-and-key-in-the-remote-monitoring-solution">Create a custom device Id and key in the remote monitoring solution</h2><p>The solutions in the Azure IoT Suite uses Azure IoT Hub for bi-directional communication with devices. When you add a device to your IoT Hub, you need to generate a Device ID and Device Key. These are unique to each device and are used by the device to authenticate to IoT Hub before it can send and receive messages.</p><blockquote><p>Note: By having a unique ID and key for each device, you are able to ensure that only devices that have been registered with IoT Hub can authenticate to it. This also enables you to revoke access for an individual device if you ever need to.</p></blockquote><p>In the dashboard of the Remote Monitoring solution, click the <strong>Add a Device</strong> button in the lower left corner of the screen.</p><p>Next, click the <strong>Add New</strong> button in the panel labeled Custom Device.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-16.png" alt="Add custom device" /></p><p>Next, select the option to define your own Device ID. I named my device <em>Adafruit-01</em>. Click the <strong>Check ID</strong> button to verify the device ID is available in your instance of Azure IoT Hub and then click <strong>Create</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-17.png" alt="Generate device ID" /></p><p>Copy the <em>Device ID</em>, <em>Device Key</em>, and the <em>IoT Hub Hostname</em> to notepad or another text editor so you can retrieve them later.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-18.png" alt="Custom device credentials" /></p><h2 id="upload-the-remote-monitoring-sketch-to-the-device">Upload the remote monitoring sketch to the device</h2><p>In this section, we will configure the remote monitoring solution code to use the SPI wiring configuration for the device and provide it the Device ID and Key it will need to authenticate to IoT Hub.</p><p>Clone (or download) the <a href="https://github.com/Azure-Samples/iot-hub-c-m0wifi-getstartedkit">device code from GitHub</a> or clone (or download) <a href="https://github.com/rickrain/iot-hub-c-m0wifi-getstartedkit">my forked copy</a> that has these changes already applied.</p><p>Open the .\remote_monitoring\remote_monitoring.ino sketch using the Arduino IDE.</p><p>In the <code class="language-plaintext highlighter-rouge">remote_monitoring.ino</code> file, include the <em>AzureIoTHubClient.h</em> and initialize an instance of <em>AzureIoTHubClient</em>. Also, set the <em>SSID</em> and <em>Secret</em> for the WIFI network you want the device to use.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-19.png" alt="Remote monitoring code" /></p><p>In the <code class="language-plaintext highlighter-rouge">bme280.cpp</code> file, change the code to initialize the BME280 sensor using the SPI wiring configuration. The original code assumed the I2C wiring configuration for the device.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-20.png" alt="Remote monitoring code" /></p><p>In the <code class="language-plaintext highlighter-rouge">remote_monitoring.c</code> file, add the <em>Device ID</em>, <em>Device Key</em> and <em>IoT Hub Name</em> that was created previously.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-21.png" alt="Remote monitoring code" /></p><p>It’s time to compile this thing and try it out! Press <strong>Ctrl-U</strong> to compile and upload the sketch to the device.</p><blockquote><p>Note: You will have to reset the device (see above) and subsequently the port in the Arduino IDE before uploading the sketch to the device.</p></blockquote><p>A successful build and upload to the device will result in output similar to what is shown here in the output window of the Arduino IDE.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-22.png" alt="Compile remote monitoring solution" /></p><p>After about 20-30 seconds the device will connect to the WiFi network, initialize the BME280 censor, and then start transmitting data to your IoT Hub instance.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-23.png" alt="Working custom device" /></p><h2 id="observe-telemetry-data-sent-to-iot-hub">Observe telemetry data sent to IoT Hub</h2><p>In the Arduino IDE, you can monitor the recordings from the device using the Serial Monitor as shown here. To open the Serial Monitor, select <strong>Tools -&gt; Serial Monitor</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-24.png" alt="Monitoring telemetry data" /></p><blockquote><p>Note: It is not necessary at this point to have the device connected to the USB port on your computer. As long as you can provide a power source and be in range of your WiFi network, the device can be placed anywhere and the telemetry data can be observed in the dashboard of the remote monitoring solution.</p></blockquote><p>In the Devices page of the remote monitoring solution, the status of the custom device will be set to <em>Running</em> as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-25.png" alt="Remote monitoring device list" /></p><p>Go back to the Dashboard page and change the device to view setting to the custom device ID to see the telemetry data coming from the device. In the image below, I exhaled on the BME280 device and then touched it with my finger to change the temperature and humidity readings.</p><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-26.png" alt="Observe temp and humidity change" /></p><h2 id="summary">Summary</h2><p>So there you have it. An end-to-end remote monitoring IoT solution with a real device! In this post I showed you how I built a custom device to send temperature and humidity data to the remote monitoring solution from Azure IoT Suite. I walked you through the steps to setup the Arduino IDE so you can compile and upload sketches to the device. Then, I deployed the remote monitoring solution from the IoT Suite and showed how to create a unique Device ID and Key from the Devices page of the remote monitoring portal. We looked at the code changes needed to support the SPI wiring configuration I chose when building the device. And finally, put it all together by uploading the sketch to the device and observing the telemetry data in the remote monitoring solution dashboard.</p><p>One final comment about the solution. After you have a physical device(s) connected to your IoT Hub, you may want to shut down the simulated devices to reduce unnecessary costs while exploring the possibilities of your custom device. The simulated devices are fantastic to get you started and to run data through the system, but there are costs associated with this.</p><p>To shut down the simulator, perform the following steps:</p><ul><li>Sign-in to the Azure portal and open the web app blade titled [solution name] jobhost.<li>Click on <strong>Settings -&gt; WebJobs</strong>.<li>Highlight the <em>DeviceSimulator-WebJob</em> and click on <strong>Stop</strong>.</ul><p><img data-proofer-ignore data-src="/assets/img/add-custom-device-azure-iot-suite-remote-monitoring-solution-27.png" alt="Stopping web job" /></p><p>IoT in Azure is a fun and very exciting space. If you want to learn more about IoT and Azure, check out the learning path available <a href="https://azure.microsoft.com/en-us/documentation/learning-paths/iot-suite/">here</a>. Hopefully this post helped to accelerate some of your own learning so you can explore the possibilities of IoT on Microsoft Azure.</p><p>Thanks for reading.</p><p>Cheers!</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Add a custom device to the Azure IoT Suite Remote Monitoring solution - Rick Rainey&url=https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Add a custom device to the Azure IoT Suite Remote Monitoring solution - Rick Rainey&u=https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Add a custom device to the Azure IoT Suite Remote Monitoring solution - Rick Rainey&url=https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/03/21/deploy-an-azure-resource-manage-template/"><div class="card-body"> <span class="timeago small" >Mar 21, 2016<i class="unloaded">2016-03-21T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deploy an Azure Resource Manager Template</h3><div class="text-muted small"><p> In my previous post I showed how to use Visual Studio 2015 to author a simple Azure Resource Manager (ARM) template from scratch. In this post, I will discuss a few options for deploying that templ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2016/03/21/deploy-an-azure-resource-manage-template/" class="btn btn-outline-primary" prompt="Older"><p>Deploy an Azure Resource Manager Template</p></a> <a href="/posts/ckad-tips/" class="btn btn-outline-primary" prompt="Newer"><p>CKAD Exam Tips</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/'; this.page.identifier = '/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
