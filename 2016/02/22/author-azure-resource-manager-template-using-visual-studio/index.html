<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Author an Azure Resource Manager Template using Visual Studio" /><meta property="og:locale" content="en" /><meta name="description" content="Updated 3/19/2016" /><meta property="og:description" content="Updated 3/19/2016" /><link rel="canonical" href="https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/" /><meta property="og:url" content="https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/" /><meta property="og:site_name" content="Rick Rainey" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2016-02-22T15:06:04-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Author an Azure Resource Manager Template using Visual Studio" /><meta name="twitter:site" content="@rickraineytx" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-22T15:38:09-05:00","datePublished":"2016-02-22T15:06:04-06:00","description":"Updated 3/19/2016","headline":"Author an Azure Resource Manager Template using Visual Studio","mainEntityOfPage":{"@type":"WebPage","@id":"https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/"},"url":"https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/"}</script><title>Author an Azure Resource Manager Template using Visual Studio | Rick Rainey</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Rick Rainey"><meta name="application-name" content="Rick Rainey"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/rick-outdoors.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Rick Rainey</a></div><div class="site-subtitle font-italic">Where I share my learnings to help others</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rickrain" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/rickraineytx" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['rickrain','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Author an Azure Resource Manager Template using Visual Studio</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Author an Azure Resource Manager Template using Visual Studio</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Rick Rainey </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 22, 2016, 3:06 PM -0600" >Feb 22, 2016<i class="unloaded">2016-02-22T15:06:04-06:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Sep 22, 2021, 3:38 PM -0500" >Sep 22, 2021<i class="unloaded">2021-09-22T15:38:09-05:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2733 words">15 min read</span></div></div><div class="post-content"><p><strong>Updated 3/19/2016</strong></p><p>Last month I wrote an <a href="http://rickrainey.com/2016/01/19/an-introduction-to-the-azure-resource-manager-arm/">introduction to Azure Resource Manager (ARM)</a> that talked about how ARM is different from the traditional Azure service management API’s (ASM) for deploying Azure resources. In that post I discussed some benefits of ARM and mentioned tools you can use to author your own ARM templates. In this post I will discuss how to use Visual Studio to author a very simple ARM template from scratch. If you’re an IT Professional and think that because I just said “Visual Studio” that this won’t apply to you – please do not stop reading. I believe you will find that Visual Studio with the Azure Tools installed delivers the ultimate experience for authoring ARM templates.</p><p>For this post I’m using the following software versions:</p><ul><li>Visual Studio 2015 w/Update 1<li>Azure Tools SDK v2.8.2</ul><h2 id="create-an-azure-resource-group-project">Create an Azure Resource Group Project</h2><p>When you first create an Azure Resource Group Project in Visual Studio you are presented with a list of common templates you can use to start defining your desired infrastructure. For example, if you wanted a set of Virtual Machines that could be used to run a scalable web server workload, then you could start with the <strong>Windows Server Virtual Machines with Load Balancer</strong> template to describe the initial infrastructure resources such as the Virtual Network, Storage Account, Load Balancer, Availability Set, Network Interfaces, and Virtual Machines. If you have ever provisioned an environment like this on-premises or even in Azure using the old Azure Service Management (ASM) API’s, you will quickly appreciate the power a template like this delivers.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-01.png" alt="VM with Load Balancer Tempalte" /></p><p>While this template is extremely useful for what it can do, it’s probably not a good choice if you’re just starting to learn how to author ARM templates, which is what this post is about. So instead, I’m going to choose the <strong>Blank Template</strong> (shown below) and incrementally add the resources needed to describe a single Virtual Machine.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-02.png" alt="ARM Blank Template" /></p><p>I believe this approach makes it easier to understand the basic concepts of ARM templates. Afterwards, you will be able to parse your way through and edit any template such as the one I referenced above.</p><h2 id="explore-the-project-structure">Explore the Project Structure</h2><p>Choosing the <strong>Blank Template</strong> results in a project that contains everything you need to begin authoring and eventually deploy your template. As shown below, the project structure contains three folders; <em>Scripts, Templates</em>, and <em>Tools</em>.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-03.png" alt="ARM Project Structure" /></p><p>The <em>Scripts</em> folder contains the PowerShell script that is used to deploy the environment you describe in the project. This is a fully functional script that essentially requires no editing. It just works! However, if you have a need to modify the script to support some advanced deployment scenarios you can do so.</p><p>The <em>Templates</em> folder contains the JSON files that describe the environment you want to create. The <em>azuredeploy.json</em> file is where you describe the resources you want in your environment, such as the storage account, virtual machine, and other required resources. The <em>azuredeploy.parameters.json</em> file is where you can provide parameter values that you want passed into the template during deployment, such as the type of storage account, size of the virtual machine, credentials to use to sign into the virtual machine, and so on.</p><p>The <em>Tools</em> folder contains AzCopy.exe and is used in scenarios where your deployment template needs to copy files to a storage account used for deploying application and configuration files into a resource. For a virtual machine, this typically would be Desired State Configuration (DSC) and DSC resources that you want pushed into the virtual machine after the virtual machine is provisioned to do things like configure Active Directory or IIS Web Server roles in the virtual machine. The script in the <em>Scripts</em> folder uses AzCopy in the <em>Tools</em> folder to copy these kinds of artifacts to a storage account so that ARM can then copy them from storage into the virtual machine after the instance is fully provisioned.</p><h2 id="resource-deployment-template">Resource Deployment Template</h2><p>Since I chose the <strong>Blank Template</strong>, the <em>azuredeploy.json</em> file contains a skeleton JSON document. Notice the <em>parameters, variables, resources</em>, and <em>outputs</em> objects. This is where the bulk of your authoring will occur as you start adding resources to the template.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span text-data=" JSON "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
 </span><span class="nl">"$schema"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"contentVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0.0"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="p">},</span><span class="w">
 </span><span class="nl">"variables"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="p">},</span><span class="w">
 </span><span class="nl">"resources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
 </span><span class="p">],</span><span class="w">
 </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>The <em>parameters</em> object is where you define parameters for your resources to be used during deployment of the template. For example, if you define a Storage Account resource in your template, then you may want to parameterize the type (Standard or Premium) of storage account.</p><p>The <em>variables</em> object is where you define variables that are referenced in your resource definitions. Using the Storage Account as an example again, you should have a variable for the name of the storage account that you can reference throughout the template rather than hard-coding the same value throughout the template.</p><p>The <em>resources</em> array is where you describe all the resources for your environment such as a Storage Account Resource, Virtual Network Resource, Virtual Machine Resource, and so on.</p><p>The <em>outputs</em> object is where you can optionally return values from your deployment. For example, you could return the public IP address of a virtual machine after it has been provisioned.</p><h3 id="json-outline-window">JSON Outline Window</h3><p>When you open the <em>azuredeploy.json</em> file, the JSON Outline Window will open to the left of your editor window as shown here. If it is not open in your environment, you can open it manually by selecting <strong>View -&gt; Other Windows -&gt; JSON Outline</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-04.png" alt="ARM Project JSON Outline" /></p><p>The JSON Outline window provides a visual representation of the parameters, variables, resources, and outputs objects defined in <em>azuredeploy.json</em>. This is extremely helpful as you add resources to the file and provides a way to easily navigate the JSON file rather than scrolling through the JSON editor. As you are about to see, it also provides a nice UI experience to add resources to your template.</p><h2 id="add-a-storage-account-resource">Add a Storage Account Resource</h2><p>The first resource I will add is a Storage Account resource. The reason I chose this is because it is small and is needed to store the VHD’s (virtual hard disks) of the virtual machine. To add a Storage Account resource, right-click on <strong>resources</strong> in the JSON Outline Windows and select <strong>Add Resource</strong>. In the Add Resource window that opens, click on the <strong>Storage Account</strong> resource, provide a <strong>Name</strong> for the storage account, and click <strong>Add</strong> as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-05.png" alt="ARM Project - Add storage account" /></p><p>The Storage Account resource is added to the <em>azuredeploy.json</em> file in the resources section. Additionally, a parameter for the type of storage account was added, and a variable for the name of the storage account is added. Notice also that the JSON Outline window gets updated. You can click on the parameter, variable, or resource in the JSON Outline window to quickly navigate to that element in the JSON file.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-06.png" alt="Azure Deploy - Storage Resource" /></p><p>The <em>name</em> property uses the <strong>variables()</strong> function to reference the value of the variable named MyStorageName. If you click on MyStorageName in the variables section of the JSON Outline window you will see the value of the variable is the name you gave the resource when adding it to the template concatenated with a uniquely generated string as shown here.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span text-data=" JSON "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">“MyStorageName”:</span><span class="w"> </span><span class="err">“</span><span class="p">[</span><span class="err">concat(‘mystorage’</span><span class="p">,</span><span class="w"> </span><span class="err">uniqueString(resourceGroup().id))</span><span class="p">]</span><span class="err">”</span><span class="w">
</span></pre></table></code></div></div><blockquote><p>The value of the <em>MyStorageName</em> variable is generated using three ARM template functions; <strong>concat()</strong>, <strong>uniqueString()</strong>, and <strong>resourceGroup()</strong>. The <strong>resourceGroup()</strong> function is a function that returns a few properties about the resource group during deployment, such as the id, location, and name of the resource group. The id property is a long path (string) that includes your Azure subscription ID and resource group name. The <strong>uniqueString()</strong> function takes the value from <strong>resourceGroup().id</strong> (a string) and generates a 64-bit hash of it to generate a string that is unique to the resource group. The reason the template does this is to avoid DNS name conflicts for the storage account. Storage Accounts are publicly addressable at a URL unique to the storage account. Therefore, the name of the storage account needs to be unique to avoid DNS name conflicts. Finally, the concat() function takes the results of the <strong>uniqueString()</strong> function and concatenates it with the constant string “mystorage” to generate a string that looks something like “mystoragetj2fcadfgy6jw”.</p></blockquote><p>The <em>type</em> property identifies the type of the resource which in this case is a Storage Account. The value for the type follows a naming convention of <resource provider="" namespace="">/<resource type="">. When this template is deployed, ARM will use this value to invoke the resource provider at “Microsoft.Storage” to create the resource type “storageAccounts”.</resource></resource></p><p>The <em>location</em> property tells ARM where to provision this resource. Generally speaking, your resources will be deployed in the same location as the resource group they will be contained in. So, the template uses the <strong>resourceGroup()</strong> function to return the <strong>location</strong> property of the resource group. So, for example, if at deployment time you specify “West US” for the region of your resource group, then your resources will also be deployed in “West US” because they will all be using the <strong>resourceGroup()</strong> function (by default).</p><p>The <em>apiVersion</em> property tells ARM which version of the resource provider to use. The resource provider version changes as new features and resource types are introduced. Hence the reason for needing to specify this value.</p><p>The <em>properties</em> object is where resource-specific properties are set. For a Storage Account, the accountType is required by the resource provider to identify the type of storage account to provision. The template takes this value as a parameter and then uses the parameters() function to retrieve the value specified during deployment.</p><h2 id="add-a-virtual-network-resource">Add a Virtual Network Resource</h2><p>A Virtual Machine in Azure requires a Virtual Network for the instance to be deployed in. You typically would probably be referencing an existing virtual network. However, for this post we’ll create a new one so we can further explore the basics of ARM templates.</p><p>Following the same process as we did to add a Storage Account resource, add a Virtual Network resource as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-07.png" alt="ARM Virtual Network Resource" /></p><p>The Virtual Network resource is added to the <em>azuredeploy.json</em> file in the resources section and some variables are also added that are referenced in the virtual network resource definition. Notice the type property is set to “Microsoft.Network/virtualNetworks”, which is telling ARM which resource provider and resource type to provision. Also, notice that the properties object has virtual network-specific properties defined, such as <em>addressSpace</em> (the address space of the virtual network) and a collection of <em>subnets</em> describing how to carve up the address space.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-08.png" alt="ARM Virtual Network Resource" /></p><h2 id="add-a-virtual-machine-resource">Add a Virtual Machine Resource</h2><p>Now that we have met the minimum resource requirements for a Virtual Machine (ie: Storage Account and Virtual Network), we can add a Virtual Machine resource to the template. Following the same process as before, add a Windows Virtual Machine resource as shown below. The dialog will prompt you to choose a Storage Account and Virtual Network (and subnet) for the Virtual Machine.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-09.png" alt="ARM Virtual Network Resource" /></p><p>The Virtual Machine resource is added to the <em>azuredeploy.json</em> file in the resources section. You will also see that a virtual Network Interface Card (NIC) resource is also added. Selecting the NIC resource in the JSON Outline Window will navigate you directly to the resource as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-10.png" alt="ARM Virtual Network Resource" /></p><p>Notice that the resource type “networkInterfaces” is a type known by the same resource provider responsible for the Virtual Network resource, which is at the namespace “Microsoft.Network”. Also notice that for this resource the dependsOn property has a reference to another resource, which is the Virtual Network resource. When this template is deployed, this tells ARM that before it can create the virtual NIC resource, it needs to first create the Virtual Network resource. The reason this dependency exists is because in the ipConfiguration properties, this NIC binds a resource (the VM – as you will see soon) to a subnet in the Virtual Network resource.</p><p>Moving down to the Virtual Machine resource, notice the resource provider and resource type is “Microsoft.Compute/virtualMachines”. Also notice that this resource dependsOn the Storage Account resource (to store it’s VHD’s) and the virtual NIC resource (to bind it to the VNET) as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-11.png" alt="ARM Virtual Network Prefix" /></p><p>The Virtual Machine resource is added to the <em>azuredeploy.json</em> file in the resources section. You will also see that a virtual Network Interface Card (NIC) resource is also added. Selecting the NIC resource in the JSON Outline Window will navigate you directly to the resource as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-10.png" alt="VS Add Resource" /></p><p>Notice that the resource type “networkInterfaces” is a type known by the same resource provider responsible for the Virtual Network resource, which is at the namespace “Microsoft.Network”. Also notice that for this resource the dependsOn property has a reference to another resource, which is the Virtual Network resource. When this template is deployed, this tells ARM that before it can create the virtual NIC resource, it needs to first create the Virtual Network resource. The reason this dependency exists is because in the <em>ipConfiguration</em> properties, this NIC binds a resource (the VM – as you will see soon) to a subnet in the Virtual Network resource.</p><p>Moving down to the Virtual Machine resource, notice the resource provider and resource type is “Microsoft.Compute/virtualMachines”. Also notice that this resource <em>dependsOn</em> the Storage Account resource (to store it’s VHD’s) and the virtual NIC resource (to bind it to the VNET) as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-11.png" alt="VM DependsOn" /></p><h2 id="add-a-public-ip-address-resource">Add a Public IP Address Resource</h2><p>Technically, we’ve added all the resources necessary to deploy a virtual machine using this template. If you want to connect to the virtual machine after this template is deployed, then you will have to configure a VPN connection to the virtual network so you can communicate to it. That’s actually a best practice for most production scenarios. However, when you’re just learning, sometimes we take shorter paths to our destination. For this post, I’ll add the Public IP Address resource which will enable you to connect to the virtual machine using Remote Desktop Protocol (RDP) over a public IP Address.</p><p>Following the same process, add a Public IP Address resource as shown here.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-12.png" alt="Public IP Address" /></p><p>Just like before, the Public IP Address resource is added to the <em>azuredeploy.json</em> file in the resources section as shown below.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-13.png" alt="Public IP Address Resource Definition" /></p><p>As you may have expected, the resource type “publicIPAddresses” is a type known by the resource provider at namespace “Microsoft.Network”. Hopefully you are recognizing that a resource provider can (and usually does) support multiple resource types. You probably also expected the virtual NIC to be in the <em>dependsOn</em> section for this resource. After all, the Add Resource dialog indicated it was a required resource and had you select the NIC resource when you added it. So, why then is it not there?!?!? The answer is that the Public IP Address resource is added as a dependent resource for the virtual NIC as shown below.</p><p><img data-proofer-ignore data-src="/assets/img/author-azure-resource manager-template-using-visual-studio-14.png" alt="Public IP Address Resource Dependency" /></p><p>If you look down a little further in the NIC properties, you will see the Public IP Address resource referenced in the <em>publicIPAddress</em> property of the <em>ipConfigurations</em> object.</p><h2 id="add-some-outputs">Add some Outputs</h2><p>When you deploy a template you may want to output values from the deployment. This is optional. For a deployment such as this (a VM) you may want to output the fully qualified DNS name for the virtual machine so you can RDP into it. For the template described in this post the outputs section could look like this.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span text-data=" JSON "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dnsName"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[reference(variables('MyPublicIPName')).dnsSettings.fqdn]"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>For the output I’m using the <strong>reference()</strong> function to reference the Public IP Address resource that gets deployed. When this template is deployed, the <strong>reference()</strong> function can be used to output the fully qualified domain name from the dnsSettings property of the resource.</p><h2 id="summary">Summary</h2><p>In this post I walked through the process of creating a new Azure Resource Group Project using the Blank Template. Next, I added resources individually to support a single virtual machine deployment. Along the way we looked at the components of a Resource Group Project, how ARM templates are structured, and how resource dependencies are defined. We also saw examples of some of the many <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-template-functions/">ARM Template Functions</a> that you can use when authoring templates and how to output information from a deployment when an ARM template is deployed. The completed solution created for this blog post is <a href="https://github.com/rickrain/ARM-Basics">available on my GitHub account</a>.</p><p>Next time I’ll show a few ways you can deploy this ARM template.</p><div id="disqus_thread"></div><script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/ /* var disqus_config = function () { this.page.url = ""; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = "/2016/02/22/author-azure-resource-manager-template-using-visual-studio/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { // DON'T EDIT BELOW THIS LINE var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Author an Azure Resource Manager Template using Visual Studio - Rick Rainey&url=https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Author an Azure Resource Manager Template using Visual Studio - Rick Rainey&u=https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Author an Azure Resource Manager Template using Visual Studio - Rick Rainey&url=https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ubuntu-dev-setup/">Developer Laptop Setup on Ubuntu</a><li><a href="/posts/ckad-tips/">CKAD Exam Tips</a><li><a href="/2013/04/16/polyglot-persistence-in-windows-azure/">Polyglot Persistence in Windows Azure</a><li><a href="/2013/05/22/implementing-polyglot-persistence-part-1/">Implementing Polyglot Persistence – Part 1</a><li><a href="/2013/05/27/setting-up-a-neo4j-server-running-on-ubuntu-in-windows-azure/">Setting up a Neo4j Server running on Ubuntu in Windows Azure</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ubuntu-dev-setup/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T09:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Developer Laptop Setup on Ubuntu</h3><div class="text-muted small"><p> This blog is really a crutch for me to remember how I like to setup my Ubuntu desktop for development work. I recently got a new laptop and had to go through the process again of setting it up the ...</p></div></div></a></div><div class="card"> <a href="/posts/ckad-tips/"><div class="card-body"> <span class="timeago small" >Oct 12, 2021<i class="unloaded">2021-10-12T10:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CKAD Exam Tips</h3><div class="text-muted small"><p> I recently took and passed the CKAD Exam and now the proud owner of the CKAD Certification issued by The Linux Foundation. Like so many others who have accomplished this, I decided to share some ti...</p></div></div></a></div><div class="card"> <a href="/2016/06/22/add-a-custom-device-to-the-azure-iot-suite-remote-monitoring-solution/"><div class="card-body"> <span class="timeago small" >Jun 22, 2016<i class="unloaded">2016-06-22T16:06:04-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add a custom device to the Azure IoT Suite Remote Monitoring solution</h3><div class="text-muted small"><p> Today, Azure IoT Suite provides two end-to-end IoT solutions; Predictive Maintenance and Remote Monitoring. These solutions can be deployed into your Azure subscription and running in just a few mi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2016/01/19/an-introduction-to-the-azure-resource-manager-arm/" class="btn btn-outline-primary" prompt="Older"><p>An Introduction to the Azure Resource Manager (ARM)</p></a> <a href="/2016/03/21/deploy-an-azure-resource-manage-template/" class="btn btn-outline-primary" prompt="Newer"><p>Deploy an Azure Resource Manager Template</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://rickrainey.com/2016/02/22/author-azure-resource-manager-template-using-visual-studio/'; this.page.identifier = '/2016/02/22/author-azure-resource-manager-template-using-visual-studio/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://rickrainey.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (modeToggle !== null) { modeToggle.addEventListener('click', reloadDisqus); window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/rickraineytx">Rick Rainey</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
